# Phos ç‰©ç†æ¨¡å¼ä½¿ç”¨æŒ‡å—

**ç‰ˆæœ¬**: v0.4.2  
**æœ€å¾Œæ›´æ–°**: 2024-12-24  
**ç‹€æ…‹**: ç”Ÿç”¢å°±ç·’ (Production Ready)

---

## ğŸ“‹ ç›®éŒ„ Table of Contents

1. [æ¦‚è¿°](#æ¦‚è¿°-overview)
2. [ç‰©ç†åŸç†](#ç‰©ç†åŸç†-physics-principles)
3. [ä¸‰ç¨®æ¨¡å¼å°æ¯”](#ä¸‰ç¨®æ¨¡å¼å°æ¯”-mode-comparison)
4. [å¿«é€Ÿé–‹å§‹](#å¿«é€Ÿé–‹å§‹-quick-start)
5. [åƒæ•¸èª¿æ•´æŒ‡å—](#åƒæ•¸èª¿æ•´æŒ‡å—-parameter-tuning)
6. [è¦–è¦ºæ•ˆæœå°æ¯”](#è¦–è¦ºæ•ˆæœå°æ¯”-visual-comparison)
7. [å¸¸è¦‹å•é¡Œ](#å¸¸è¦‹å•é¡Œ-faq)
8. [æŠ€è¡“ç´°ç¯€](#æŠ€è¡“ç´°ç¯€-technical-details)

---

## æ¦‚è¿° Overview

Phos v0.2.0 å¼•å…¥äº†**ç‰©ç†å°å‘æ¨¡å¼**ï¼Œåœ¨ä¿ç•™è—è¡“æ•ˆæœçš„åŒæ™‚ï¼Œæä¾›æ›´ç¬¦åˆç‰©ç†è¦å¾‹çš„è† ç‰‡æ¨¡æ“¬ã€‚

### ç‚ºä»€éº¼éœ€è¦ç‰©ç†æ¨¡å¼ï¼ŸWhy Physical Mode?

**è—è¡“æ¨¡å¼çš„é™åˆ¶ Limitations of Artistic Mode**:
- âŒ é•åèƒ½é‡å®ˆæ†ï¼ˆBloom æ•ˆæœæœƒå¢åŠ ç¸½èƒ½é‡ +10%ï¼‰
- âŒ é¡†ç²’å™ªè²åˆ†å¸ƒä¸ç¬¦åˆå…‰å­çµ±è¨ˆï¼ˆä¸­èª¿å³°å€¼ vs æš—éƒ¨å³°å€¼ï¼‰
- âŒ ç¼ºä¹çœŸå¯¦çš„è† ç‰‡ç‰¹æ€§æ›²ç·šï¼ˆH&D æ›²ç·šï¼‰
- âŒ å‘½åèª¤å°ï¼ˆ`luminance` å¯¦éš›éå…‰åº¦å­¸äº®åº¦ï¼‰

**ç‰©ç†æ¨¡å¼çš„å„ªå‹¢ Advantages of Physical Mode**:
- âœ… èƒ½é‡å®ˆæ†ï¼ˆèª¤å·® < 0.01%ï¼‰
- âœ… å…‰å­çµ±è¨ˆå™ªè²ï¼ˆSNR âˆ âˆšæ›å…‰é‡ï¼‰
- âœ… H&D ç‰¹æ€§æ›²ç·šï¼ˆå°æ•¸éŸ¿æ‡‰ + Toe/Shoulderï¼‰
- âœ… èªç¾©æ¸…æ™°ï¼ˆ`spectral_response` è€Œé `luminance`ï¼‰

### è¨­è¨ˆå“²å­¸ Design Philosophy

1. **å‘å¾Œç›¸å®¹ Backward Compatibility**: é è¨­ ARTISTIC æ¨¡å¼ï¼Œä¸å½±éŸ¿ç¾æœ‰ç”¨æˆ¶
2. **å¯é¸æ€§ Optionality**: å¯åˆ†åˆ¥å•Ÿç”¨/ç¦ç”¨å„é …ç‰©ç†ç‰¹æ€§
3. **æ··åˆæ¨¡å¼ Hybrid Mode**: è—è¡“èˆ‡ç‰©ç†è‡ªç”±çµ„åˆ
4. **å¯é©—è­‰æ€§ Verifiability**: å®Œæ•´æ¸¬è©¦å¥—ä»¶ï¼ˆ26/26 testsï¼‰

---

## ç‰©ç†åŸç† Physics Principles

### 1. èƒ½é‡å®ˆæ† Energy Conservation

**å•é¡Œ Problem**: è—è¡“æ¨¡å¼çš„ Bloom æ•ˆæœæœƒå¢åŠ å½±åƒç¸½èƒ½é‡ï¼ˆé•åèƒ½é‡å®ˆæ†å®šå¾‹ï¼‰

**åŸç† Theory**:
```
èƒ½é‡å®ˆæ†å®šå¾‹: âˆ«âˆ« L_out dÏ‰ dA = âˆ«âˆ« L_in dÏ‰ dA
```

**å¯¦ä½œ Implementation**:
1. **é«˜å…‰æå–**: æå–è¶…éé–¾å€¼çš„åƒç´ 
2. **èƒ½é‡è¨ˆç®—**: E_scatter = âˆ‘(highlights) Ã— scattering_ratio
3. **PSF æ­£è¦åŒ–**: PSF = PSF / âˆ‘PSF  â† **é—œéµæ­¥é©Ÿ**
4. **å·ç©æ•£å°„**: Bloom = conv(highlights, PSF_normalized)
5. **èƒ½é‡é©—è­‰**: E_out â‰ˆ E_inï¼ˆèª¤å·® < 0.01%ï¼‰

**æ¸¬è©¦çµæœ**:
```
è—è¡“æ¨¡å¼: E_out = 1375.55, E_in = 1250.50 â†’ +10.0% âŒ
ç‰©ç†æ¨¡å¼: E_out = 1250.50, E_in = 1250.50 â†’ +0.0% âœ…
```

---

### 2. H&D ç‰¹æ€§æ›²ç·š Hurter-Driffield Curve

**å•é¡Œ Problem**: è—è¡“æ¨¡å¼ç¼ºä¹çœŸå¯¦è† ç‰‡çš„æ›å…‰-å¯†åº¦é—œä¿‚

**åŸç† Theory**:
```
å¯†åº¦ Density: D = Î³ Ã— logâ‚â‚€(H) + D_fog
é€å°„ç‡ Transmittance: T = 10^(-D)
```

**ä¸‰å€‹å€æ®µ Three Regions**:
1. **Toeï¼ˆè…³éƒ¨ï¼‰**: é™°å½±å£“ç¸®ï¼Œä½æ›å…‰é‡æŸ”å’Œéæ¸¡
2. **Linearï¼ˆç·šæ€§ï¼‰**: ä¸»é«”å°æ¯”åº¦ï¼Œç”± gamma æ§åˆ¶
3. **Shoulderï¼ˆè‚©éƒ¨ï¼‰**: é«˜å…‰å£“ç¸®ï¼Œæ¼¸é€²é£½å’Œè‡³ D_max

**æ•ˆæœ Effects**:
- **å‹•æ…‹ç¯„åœå£“ç¸®**: 10^8 â†’ 10^3ï¼ˆå£“ç¸® 5.2Ã—10^4 å€ï¼‰
- **é™°å½±æå‡**: Toe å€æ®µé€å°„ç‡ +0.278ï¼ˆå½±åƒè®Šäº®ï¼‰
- **é«˜å…‰ç´°ç¯€**: Shoulder å€æ®µä¿ç•™éæ›ç´°ç¯€

**å¯¦ä½œç´°ç¯€**:
```python
# 1. å°æ•¸éŸ¿æ‡‰
log_exposure = np.log10(np.clip(exposure, 1e-10, None))
density = gamma * log_exposure + offset

# 2. Toe æ›²ç·šï¼ˆSigmoid éæ¸¡ï¼‰
toe_factor = 1 / (1 + np.exp(-toe_strength * (log_exposure - toe_position)))
density = density * toe_factor

# 3. Shoulder æ›²ç·šï¼ˆæŒ‡æ•¸é£½å’Œï¼‰
density = D_max * (1 - np.exp(-density / shoulder_scale))

# 4. å¯†åº¦ â†’ é€å°„ç‡
transmittance = 10 ** (-density)
```

---

### 3. æ³Šæ¾é¡†ç²’å™ªè² Poisson Grain Noise

**å•é¡Œ Problem**: è—è¡“æ¨¡å¼çš„é¡†ç²’åœ¨ä¸­èª¿æœ€æ˜é¡¯ï¼ˆè¦–è¦ºå°å‘ï¼‰ï¼Œä½†çœŸå¯¦è† ç‰‡çš„é¡†ç²’æ‡‰è©²åœ¨æš—éƒ¨æœ€æ˜é¡¯ï¼ˆç‰©ç†çµ±è¨ˆï¼‰

**åŸç† Theory**:
```
å…‰å­è¨ˆæ•¸çµ±è¨ˆ: N ~ Poisson(Î»), where Î» = æ›å…‰é‡
ä¿¡å™ªæ¯”: SNR = Î» / âˆšÎ» = âˆšÎ»
ç›¸å°å™ªè²: Ïƒ_rel = âˆšÎ» / Î» = 1 / âˆšÎ»
```

**é—œéµç‰¹æ€§**:
- **æš—éƒ¨å™ªè²æ˜é¡¯**: Î» å° â†’ SNR ä½ â†’ é¡†ç²’æ˜é¡¯
- **äº®éƒ¨å™ªè²æŠ‘åˆ¶**: Î» å¤§ â†’ SNR é«˜ â†’ é¡†ç²’ä¸æ˜é¡¯
- **æ ¹è™Ÿé—œä¿‚**: SNR âˆ âˆšæ›å…‰é‡ï¼ˆç‰©ç†æ­£ç¢ºï¼‰

**å¯¦ä½œå„ªåŒ–**:
- **æ­£æ…‹è¿‘ä¼¼**: Î» > 20 æ™‚ï¼ŒPoisson(Î») â‰ˆ Normal(Î», âˆšÎ»)ï¼ˆæ•ˆèƒ½æå‡ ~10xï¼‰
- **ç©ºé–“ç›¸é—œæ€§**: é«˜æ–¯æ¨¡ç³Šæ¨¡æ“¬éŠ€é¹½æ™¶é«”å°ºå¯¸
- **é¡†ç²’å¯†åº¦**: ä¾ ISO æ„Ÿå…‰åº¦èª¿æ•´ï¼ˆISO 100: 0.5Î¼m, ISO 400: 1.5Î¼mï¼‰

**æ¸¬è©¦çµæœ**:
```
æš—éƒ¨ (æ›å…‰ 0.1): SNR = 0.15  â† å™ªè²æ˜é¡¯ âœ…
äº®éƒ¨ (æ›å…‰ 0.9): SNR = 2.86  â† å™ªè²æŠ‘åˆ¶ âœ…
```

---

### 4. äº’æ˜“å¾‹å¤±æ•ˆ Reciprocity Failure (v0.4.2 æ–°å¢)

**å•é¡Œ Problem**: è† ç‰‡åœ¨é•·æ›å…‰æ™‚ï¼ˆ> 1ç§’ï¼‰æœƒå‡ºç¾éç·šæ€§éŸ¿æ‡‰ï¼Œå°è‡´äº®åº¦æå¤±å’Œè‰²å

**åŸç† Theory**:
```
Schwarzschild å®šå¾‹: E_eff = I Â· t^p
æ­£è¦åŒ–å½¢å¼ï¼ˆå¯¦ä½œï¼‰: I_eff = I Â· t^(p-1)

å…¶ä¸­:
- I: å…‰å¼·åº¦ (intensity)
- t: æ›å…‰æ™‚é–“ (exposure time, seconds)
- p: Schwarzschild æŒ‡æ•¸ï¼ˆ< 1.0ï¼Œå…¸å‹ç¯„åœ 0.85-0.93ï¼‰
```

**é—œéµç‰¹æ€§**:
- **é•·æ›å…‰äº®åº¦æå¤±**: t=30s, p=0.90 â†’ ~40% äº®åº¦æå¤±
- **è‰²åç¾è±¡**: ä¸åŒè‰²å±¤å¤±æ•ˆç¨‹åº¦ä¸åŒ
  - ç´…è‰²å±¤: p=0.93ï¼ˆå¤±æ•ˆæœ€ä½ï¼‰
  - ç¶ è‰²å±¤: p=0.90ï¼ˆä¸­ç­‰å¤±æ•ˆï¼‰
  - è—è‰²å±¤: p=0.87ï¼ˆå¤±æ•ˆæœ€é«˜ï¼‰â†’ é•·æ›å…‰åæš–è‰²èª¿
- **å°æ•¸è¡°æ¸›**: `p(t) = p0 - kÂ·log10(t/t_ref)`ï¼ˆç¬¦åˆæ–‡ç»æ›²ç·šï¼‰

**çœŸå¯¦è† ç‰‡æ•¸æ“š**:
```
è† ç‰‡é¡å‹            30ç§’æ›å…‰äº®åº¦æå¤±    è‰²åç‰¹æ€§
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Kodak Portra 400    ~39%              æ¥µå°ï¼ˆT-Grain æŠ€è¡“ï¼‰
Kodak Ektar 100     ~35%              æ¥µå°ï¼ˆç¾ä»£ä¹³åŠ‘ï¼‰
Fuji Velvia 50      ~56%              æ˜é¡¯ï¼ˆåè½‰ç‰‡ï¼‰
Ilford HP5 Plus 400 ~40%              ç„¡ï¼ˆé»‘ç™½è† ç‰‡ï¼‰
Kodak Tri-X 400     ~48%              ç„¡ï¼ˆé»‘ç™½è† ç‰‡ï¼‰
Cinestill 800T      ~41%              å°ï¼ˆé›»å½±è† ç‰‡ï¼‰
```

**UI æ§åˆ¶**:
- æ›å…‰æ™‚é–“æ»‘æ¡¿ï¼š0.0001s - 300sï¼ˆå°æ•¸å°ºåº¦ï¼‰
- å³æ™‚æ•ˆæœé è¦½ï¼š
  - EV è£œå„Ÿè¨ˆç®—ï¼ˆä¾‹ï¼š30s â†’ "+0.9 EV"ï¼‰
  - é ä¼°äº®åº¦æå¤±ç™¾åˆ†æ¯”
  - è‰²åè¶¨å‹¢æŒ‡ç¤º

**å¯¦ä½œç´°ç¯€**:
```python
def apply_reciprocity_failure(intensity, exposure_time, params):
    """
    æ‡‰ç”¨ Schwarzschild å®šå¾‹ï¼ˆæ­£è¦åŒ–ç‰ˆæœ¬ï¼‰
    
    å‘å¾Œç›¸å®¹æ€§: t=1s â†’ I_eff = Iï¼ˆç„¡è®ŠåŒ–ï¼‰
    èƒ½é‡å®ˆæ†: åƒ…æ¸›å°‘æˆ–ä¿æŒèƒ½é‡ï¼Œä¸å¢åŠ 
    """
    if params.p_mono is not None:
        # é»‘ç™½è† ç‰‡ï¼šå–®é€šé“è™•ç†
        p = params.p_mono
        return intensity * (exposure_time ** (p - 1.0))
    else:
        # å½©è‰²è† ç‰‡ï¼šåˆ†é€šé“è™•ç†ï¼ˆæ¨¡æ“¬è‰²åï¼‰
        result = np.zeros_like(intensity)
        for ch, p in enumerate([params.p_red, params.p_green, params.p_blue]):
            result[:,:,ch] = intensity[:,:,ch] * (exposure_time ** (p - 1.0))
        return result
```

**é©ç”¨å ´æ™¯**:
- ğŸŒŒ **æ˜Ÿç©ºæ”å½±**: 60-300s é•·æ›å…‰è‰²åæ¨¡æ“¬
- ğŸŒ„ **é¢¨æ™¯æ”å½±**: é»ƒæ˜/è—èª¿æ™‚åˆ»å»¶é•·æ›å…‰ï¼ˆ10-60sï¼‰
- ğŸ’¡ **å…‰ç¹ªå‰µä½œ**: åˆ©ç”¨äº’æ˜“å¾‹å¤±æ•ˆçš„å‰µæ„æ•ˆæœ
- ğŸ“œ **æ­·å²é‡ç¾**: åŒ¹é…è€è† ç‰‡å¤–è§€ï¼ˆå‰ç¾ä»£ä¹³åŠ‘ï¼‰

**æ¸¬è©¦çµæœ**:
```
å‘å¾Œç›¸å®¹æ€§: t=1s â†’ è®ŠåŒ– < 0.1% âœ…
èƒ½é‡å®ˆæ†: ç„¡èƒ½é‡å¢åŠ  âœ…
æ–‡ç»é©—è­‰: Kodak P-315 æ•¸æ“šå»åˆåº¦ 90-95% âœ…
æ•ˆèƒ½: 1024Ã—1024 @ 3.65 msï¼ˆ< 1% overheadï¼‰âœ…
```

**æŠ€è¡“æ–‡æª”**: `tasks/TASK-014-reciprocity-failure/`  
**æ–°æ¨¡çµ„**: `reciprocity_failure.py` (514 è¡Œ)

---

## ä¸‰ç¨®æ¨¡å¼å°æ¯” Mode Comparison

| ç‰¹æ€§ Feature | ARTISTICï¼ˆè—è¡“ï¼‰| PHYSICALï¼ˆç‰©ç†ï¼‰| HYBRIDï¼ˆæ··åˆï¼‰|
|-------------|----------------|----------------|---------------|
| **èƒ½é‡å®ˆæ†** | âŒ é•åï¼ˆ+10%ï¼‰| âœ… å®ˆæ†ï¼ˆ<0.01%ï¼‰| å¯é¸ |
| **Bloom PSF** | é«˜æ–¯æ¨¡ç³Š | PSF æ­£è¦åŒ– | å¯é¸ |
| **H&D æ›²ç·š** | âŒ ç„¡ | âœ… å°æ•¸+Toe+Shoulder | å¯é¸ |
| **é¡†ç²’åˆ†å¸ƒ** | ä¸­èª¿å³°å€¼ | æš—éƒ¨å³°å€¼ï¼ˆPoissonï¼‰| å¯é¸ |
| **äº’æ˜“å¾‹å¤±æ•ˆ** (v0.4.2) | âŒ ç„¡ | âœ… Schwarzschild å®šå¾‹ | å¯é¸ |
| **ç‰©ç†æº–ç¢ºæ€§** | ä½ï¼ˆè¦–è¦ºå°å‘ï¼‰| é«˜ï¼ˆç‰©ç†å°å‘ï¼‰| ä¸­ï¼ˆè‡ªå®šç¾©ï¼‰|
| **è¦–è¦ºæ•ˆæœ** | è¨å–œã€é®®è‰· | çœŸå¯¦ã€æŸ”å’Œ | å½ˆæ€§é…ç½® |
| **é©ç”¨å ´æ™¯** | æ—¥å¸¸ç…§ç‰‡ã€ç¤¾äº¤åª’é«” | ç§‘å­¸å¯è¦–åŒ–ã€ç ”ç©¶ | å°ˆæ¥­å‰µä½œ |
| **æ•ˆèƒ½é–‹éŠ·** | åŸºæº–ï¼ˆ~0.7sï¼‰| +9%ï¼ˆ~0.8sï¼‰| ä¾é…ç½® |

### ä½•æ™‚ä½¿ç”¨å“ªç¨®æ¨¡å¼ï¼ŸWhen to Use Which Mode?

#### ARTISTICï¼ˆæ¨è–¦çµ¦å¤§å¤šæ•¸ç”¨æˆ¶ï¼‰
- âœ… å¿«é€Ÿç¾åŒ–ç…§ç‰‡
- âœ… ç¤¾äº¤åª’é«”åˆ†äº«
- âœ… è¿½æ±‚è¦–è¦ºè¡æ“ŠåŠ›
- âœ… ä¸é—œå¿ƒç‰©ç†æº–ç¢ºæ€§

#### PHYSICALï¼ˆæ¨è–¦çµ¦å°ˆæ¥­ç”¨æˆ¶ï¼‰
- âœ… ç§‘å­¸å¯è¦–åŒ–
- âœ… ç‰©ç†ç ”ç©¶/æ•™å­¸
- âœ… æ¨¡æ“¬çœŸå¯¦è† ç‰‡è¡Œç‚º
- âœ… éœ€è¦èƒ½é‡å®ˆæ†

#### HYBRIDï¼ˆæ¨è–¦çµ¦å‰µä½œè€…ï¼‰
- âœ… æƒ³è¦éƒ¨åˆ†ç‰©ç†ç‰¹æ€§ï¼ˆå¦‚ H&D æ›²ç·šï¼‰
- âœ… éœ€è¦è—è¡“èˆ‡ç‰©ç†å¹³è¡¡
- âœ… å®¢è£½åŒ–é¢¨æ ¼
- âœ… å¯¦é©—æ€§å‰µä½œ

---

## å¿«é€Ÿé–‹å§‹ Quick Start

### æ–¹æ³• 1: ç´”ç‰©ç†æ¨¡å¼ï¼ˆæœ€ç°¡å–®ï¼‰

```python
from film_models import get_film_profile, PhysicsMode
import importlib.util

# è¼‰å…¥ Phos æ¨¡çµ„
spec = importlib.util.spec_from_file_location("phos", "Phos_0.2.0.py")
phos = importlib.util.module_from_spec(spec)
spec.loader.exec_module(phos)

# è¼‰å…¥åº•ç‰‡ + å•Ÿç”¨ç‰©ç†æ¨¡å¼
film = get_film_profile("NC200")
film.physics_mode = PhysicsMode.PHYSICAL  # â† ä¸€éµå•Ÿç”¨

# è™•ç†å½±åƒ
import cv2
image = cv2.imread("input.jpg")
response_r, response_g, response_b, response_total = phos.spectral_response(image, film)
result = phos.optical_processing(response_r, response_g, response_b, response_total, 
                                 film, grain_style="auto", tone_style="filmic")
cv2.imwrite("output_physical.jpg", result)
```

### æ–¹æ³• 2: æ··åˆæ¨¡å¼ï¼ˆå½ˆæ€§é…ç½®ï¼‰

```python
film = get_film_profile("NC200")
film.physics_mode = PhysicsMode.HYBRID

# åªå•Ÿç”¨ H&D æ›²ç·šï¼ˆä¿ç•™è—è¡“ Bloom èˆ‡é¡†ç²’ï¼‰
film.hd_curve_params.enabled = True
film.bloom_params.mode = "artistic"
film.grain_params.mode = "artistic"

# æˆ–è€…ï¼šåªå•Ÿç”¨ç‰©ç† Bloomï¼ˆä¿ç•™è—è¡“é¡†ç²’ï¼‰
film.bloom_params.mode = "physical"
film.grain_params.mode = "artistic"
film.hd_curve_params.enabled = False
```

### æ–¹æ³• 3: å®Œå…¨è‡ªå®šç¾©ï¼ˆé€²éšï¼‰

```python
film = get_film_profile("Portra400")
film.physics_mode = PhysicsMode.PHYSICAL

# Bloom å¾®èª¿
film.bloom_params.enabled = True
film.bloom_params.mode = "physical"
film.bloom_params.threshold = 0.85            # é«˜å…‰é–¾å€¼
film.bloom_params.scattering_ratio = 0.12     # æ•£å°„æ¯”ä¾‹
film.bloom_params.psf_type = "exponential"    # PSF é¡å‹

# H&D æ›²ç·šå¾®èª¿ï¼ˆæ¨¡æ“¬ Portra 400 ç‰¹æ€§ï¼‰
film.hd_curve_params.enabled = True
film.hd_curve_params.gamma = 0.62             # Portra çš„ä½å°æ¯”
film.hd_curve_params.D_min = 0.08             # ä½é›¾åº¦
film.hd_curve_params.D_max = 2.8              # å¯¬å®¹åº¦é«˜
film.hd_curve_params.toe_strength = 2.5       # é™°å½±æŸ”å’Œ
film.hd_curve_params.shoulder_strength = 2.0  # é«˜å…‰å¯¬å®¹

# é¡†ç²’å¾®èª¿ï¼ˆISO 400 ç‰¹æ€§ï¼‰
film.grain_params.enabled = True
film.grain_params.mode = "poisson"
film.grain_params.grain_size = 1.2            # ä¸­ç­‰é¡†ç²’
film.grain_params.intensity = 0.6             # é©åº¦å™ªè²
```

---

## åƒæ•¸èª¿æ•´æŒ‡å— Parameter Tuning

### Bloom åƒæ•¸ Bloom Parameters

#### `bloom_params.mode`
```python
mode = "artistic"  # è—è¡“æ¨¡å¼ï¼ˆå¯å¢åŠ èƒ½é‡ï¼‰
mode = "physical"  # ç‰©ç†æ¨¡å¼ï¼ˆèƒ½é‡å®ˆæ†ï¼‰
```

#### `bloom_params.threshold` (ç¯„åœ: 0-1)
é«˜å…‰æå–é–¾å€¼ï¼Œæ§åˆ¶å“ªäº›åƒç´ åƒèˆ‡æ•£å°„ã€‚

```python
threshold = 0.6   # ä½é–¾å€¼ â†’ æ›´å¤šé«˜å…‰ â†’ å…‰æšˆæ˜é¡¯ã€æŸ”å’Œ
threshold = 0.8   # ä¸­ç­‰ï¼ˆæ¨è–¦ï¼‰â†’ å¹³è¡¡
threshold = 0.95  # é«˜é–¾å€¼ â†’ åƒ…æ¥µäº®è™• â†’ å…‰æšˆé›†ä¸­ã€éŠ³åˆ©
```

**èª¿æ•´å»ºè­°**:
- äººåƒï¼š0.75-0.85ï¼ˆæŸ”å’Œå…‰æšˆï¼Œçš®è†šé€šé€ï¼‰
- é¢¨æ™¯ï¼š0.80-0.90ï¼ˆä¿ç•™ç´°ç¯€ï¼Œé™½å…‰è€€æ–‘ï¼‰
- å¤œæ™¯ï¼š0.60-0.75ï¼ˆæ˜é¡¯å…‰æšˆï¼Œé›»å½±æ„Ÿï¼‰

#### `bloom_params.scattering_ratio` (ç¯„åœ: 0-1, åƒ…ç‰©ç†æ¨¡å¼)
æ•£å°„èƒ½é‡æ¯”ä¾‹ï¼Œæ§åˆ¶å¤šå°‘é«˜å…‰èƒ½é‡åƒèˆ‡æ•£å°„ã€‚

```python
scattering_ratio = 0.05   # è¼•å¾® â†’ è‡ªç„¶ã€ä¸æ˜é¡¯
scattering_ratio = 0.10   # ä¸­ç­‰ï¼ˆæ¨è–¦ï¼‰â†’ æ˜é¡¯ä½†ä¸éåº¦
scattering_ratio = 0.30   # å¼·çƒˆ â†’ é›»å½±æ„Ÿã€å¤¢å¹»
```

**ç‰©ç†æ„ç¾©**:
- çœŸå¯¦è† ç‰‡ï¼š~5-15%ï¼ˆä¾ä¹³åŠ‘åšåº¦èˆ‡ Halation å±¤ï¼‰
- é›»å½±è† ç‰‡ï¼š~10-25%ï¼ˆCineStill ç­‰ç‰¹æ®Šè™•ç†ï¼‰

#### `bloom_params.psf_type`
é»æ“´æ•£å‡½æ•¸é¡å‹ã€‚

```python
psf_type = "gaussian"     # é«˜æ–¯ â†’ æŸ”å’Œã€å‡å‹»æ“´æ•£
psf_type = "exponential"  # æŒ‡æ•¸ â†’ ä¸­å¿ƒé›†ä¸­ã€å°¾éƒ¨é•·ï¼ˆæ›´çœŸå¯¦ï¼‰
```

---

### H&D æ›²ç·šåƒæ•¸ H&D Curve Parameters

#### `hd_curve_params.gamma` (ç¯„åœ: 0.5-2.5)
è† ç‰‡å°æ¯”åº¦ï¼ˆ**æ³¨æ„ï¼šéé¡¯ç¤º gamma 2.2**ï¼‰ã€‚

```python
gamma = 0.60  # è² ç‰‡ä½å°æ¯”ï¼ˆPortra, Ektarï¼‰
gamma = 0.65  # è² ç‰‡æ¨™æº–ï¼ˆC200, Superiaï¼‰
gamma = 0.70  # è² ç‰‡é«˜å°æ¯”ï¼ˆCinestillï¼‰

gamma = 1.50  # æ­£ç‰‡ä½å°æ¯”ï¼ˆVelvia 50ï¼‰
gamma = 1.80  # æ­£ç‰‡æ¨™æº–ï¼ˆE100, Proviaï¼‰
gamma = 2.20  # æ­£ç‰‡é«˜å°æ¯”ï¼ˆé»‘ç™½æ­£ç‰‡ï¼‰
```

**æ•ˆæœ**:
- **ä½ gamma (0.5-0.7)**: æŸ”å’Œã€å¯¬å®¹åº¦é«˜ã€é™°å½±ç´°ç¯€è±å¯Œ
- **ä¸­ gamma (0.7-1.5)**: å¹³è¡¡ã€è‡ªç„¶
- **é«˜ gamma (1.5-2.5)**: å°æ¯”å¼·ã€é®®è‰·ã€æˆ²åŠ‡æ€§

#### `hd_curve_params.D_min` (ç¯„åœ: 0.05-0.3)
æœ€å°å¯†åº¦ï¼ˆéœ§åº¦ï¼‰ï¼Œæ§åˆ¶æœ€æš—è™•çš„é€å°„ç‡ã€‚

```python
D_min = 0.05  # ä½éœ§åº¦ â†’ é»‘è‰²æ›´æ·±ã€å°æ¯”å¼·
D_min = 0.10  # æ¨™æº–ï¼ˆæ¨è–¦ï¼‰â†’ å¹³è¡¡
D_min = 0.20  # é«˜éœ§åº¦ â†’ è¤ªè‰²æ„Ÿã€å¾©å¤é¢¨æ ¼
```

**ç‰©ç†æ„ç¾©**: æœªæ›å…‰è† ç‰‡çš„åŸºåº•å¯†åº¦ï¼ˆåŒ–å­¸éœ§ã€æŸ“æ–™æ®˜ç•™ï¼‰

#### `hd_curve_params.D_max` (ç¯„åœ: 2.0-4.0)
æœ€å¤§å¯†åº¦ï¼ˆé£½å’Œé»ï¼‰ï¼Œæ§åˆ¶æœ€äº®è™•çš„é€å°„ç‡ä¸‹é™ã€‚

```python
D_max = 2.5   # ä½é£½å’Œ â†’ éæ›æ˜“å¤±å»ç´°ç¯€
D_max = 3.0   # æ¨™æº–ï¼ˆæ¨è–¦ï¼‰â†’ å¹³è¡¡
D_max = 3.5   # é«˜é£½å’Œ â†’ é«˜å…‰ç´°ç¯€è±å¯Œã€å¯¬å®¹åº¦é«˜
```

**ç‰©ç†æ„ç¾©**: éŠ€é¹½æ™¶é«”å®Œå…¨æ›å…‰å¾Œçš„æœ€å¤§å…‰å­¸å¯†åº¦

#### `hd_curve_params.toe_strength` (ç¯„åœ: 0.5-5.0)
Toe æ›²ç·šå¼·åº¦ï¼Œæ§åˆ¶é™°å½±å£“ç¸®ç¨‹åº¦ã€‚

```python
toe_strength = 1.0   # å¼± â†’ é™°å½±å°æ¯”å¼·ã€æš—éƒ¨æ·±é‚ƒ
toe_strength = 2.0   # ä¸­ç­‰ï¼ˆæ¨è–¦ï¼‰â†’ è‡ªç„¶éæ¸¡
toe_strength = 4.0   # å¼· â†’ é™°å½±æŸ”å’Œã€æš—éƒ¨ç´°ç¯€è±å¯Œ
```

**è¦–è¦ºæ•ˆæœ**: é«˜ toe_strength æœƒã€Œæäº®ã€é™°å½±ï¼Œé¡ä¼¼ã€Œæš—éƒ¨+æ›å…‰ã€

#### `hd_curve_params.shoulder_strength` (ç¯„åœ: 0.5-3.0)
Shoulder æ›²ç·šå¼·åº¦ï¼Œæ§åˆ¶é«˜å…‰å£“ç¸®ç¨‹åº¦ã€‚

```python
shoulder_strength = 1.0   # å¼± â†’ é«˜å…‰æ—©é£½å’Œã€éæ›æ˜“å¤±ç´°ç¯€
shoulder_strength = 1.5   # ä¸­ç­‰ï¼ˆæ¨è–¦ï¼‰â†’ å¹³è¡¡
shoulder_strength = 2.5   # å¼· â†’ é«˜å…‰æ¸é€²é£½å’Œã€éæ›ç´°ç¯€ä¿ç•™
```

**è¦–è¦ºæ•ˆæœ**: é«˜ shoulder_strength æœƒã€Œå£“åˆ¶ã€é«˜å…‰ï¼Œé¡ä¼¼ã€Œé«˜å…‰-æ›å…‰ã€

---

### é¡†ç²’åƒæ•¸ Grain Parameters

#### `grain_params.mode`
```python
mode = "artistic"  # è—è¡“æ¨¡å¼ï¼ˆä¸­èª¿å³°å€¼ï¼‰
mode = "poisson"   # æ³Šæ¾æ¨¡å¼ï¼ˆæš—éƒ¨å³°å€¼ï¼Œç‰©ç†çµ±è¨ˆï¼‰
```

#### `grain_params.grain_size` (ç¯„åœ: 0.5-3.0)
éŠ€é¹½é¡†ç²’å°ºå¯¸ï¼ˆÎ¼m ç­‰æ•ˆï¼‰ï¼Œå½±éŸ¿ç©ºé–“ç›¸é—œæ€§ã€‚

```python
grain_size = 0.5   # ISO 100 â†’ æ¥µç´°ç·»ã€å¹¾ä¹ä¸å¯è¦‹
grain_size = 1.0   # ISO 200 â†’ ç´°è†©ã€å°ˆæ¥­
grain_size = 1.5   # ISO 400 â†’ æ˜é¡¯ã€ç¶“å…¸è† ç‰‡æ„Ÿ
grain_size = 2.5   # ISO 1600 â†’ ç²—ç³™ã€è¡—æ‹é¢¨æ ¼
grain_size = 3.5   # ISO 3200+ â†’ æ¥µç²—ã€å‰µæ„æ•ˆæœ
```

**ç‰©ç†å°æ‡‰**:
| ISO | é¡†ç²’å°ºå¯¸ (Î¼m) | æ¨è–¦ `grain_size` |
|-----|--------------|------------------|
| 100 | 0.5-0.8 | 0.5-1.0 |
| 400 | 1.0-1.5 | 1.0-2.0 |
| 800 | 1.5-2.0 | 1.5-2.5 |
| 1600+ | 2.0-3.0 | 2.0-3.5 |

#### `grain_params.intensity` (ç¯„åœ: 0-2.0)
å™ªè²å¼·åº¦ï¼Œæ§åˆ¶é¡†ç²’çš„è¦–è¦ºæ˜é¡¯ç¨‹åº¦ã€‚

```python
intensity = 0.3   # è¼•å¾® â†’ å¹¾ä¹ä¸å¯è¦‹ã€å°ˆæ¥­å“è³ª
intensity = 0.6   # é©ä¸­ï¼ˆæ¨è–¦ï¼‰â†’ æ˜é¡¯ä½†ä¸å¹²æ“¾
intensity = 1.0   # æ˜é¡¯ â†’ ç¶“å…¸è† ç‰‡æ„Ÿ
intensity = 1.5   # å¼·çƒˆ â†’ è¡—æ‹ã€Lomo é¢¨æ ¼
```

**å»ºè­°çµ„åˆ**:
- **ä¹¾æ·¨é¢¨æ ¼**: `grain_size=0.5, intensity=0.3`ï¼ˆEktar 100 æ„Ÿï¼‰
- **ç¶“å…¸è† ç‰‡**: `grain_size=1.5, intensity=0.8`ï¼ˆC200, Superia æ„Ÿï¼‰
- **è¡—æ‹é¢¨æ ¼**: `grain_size=2.0, intensity=1.2`ï¼ˆHP5+, Tri-X æ„Ÿï¼‰
- **Lomo é¢¨æ ¼**: `grain_size=2.5, intensity=1.8`ï¼ˆæ¥µç«¯é¡†ç²’ï¼‰

---

### Mie æ•£å°„æŸ¥è¡¨åƒæ•¸ Mie Scattering Lookup Parameters (v0.3.0)

#### æ¦‚è¿°
**Phase 5.5** å¼•å…¥é«˜å¯†åº¦ Mie æ•£å°„æŸ¥è¡¨ (v2)ï¼Œä½¿ç”¨çœŸå¯¦ç‰©ç†è¨ˆç®—å–ä»£ç¶“é©—å…¬å¼ã€‚

**é—œéµæ”¹é€²**:
- **ç²¾åº¦æå‡**: Î· æ’å€¼èª¤å·®å¾ 155% â†’ 2.16%ï¼ˆ**72x æ”¹å–„**ï¼‰
- **æ ¼é»å¯†åº¦**: 21 â†’ 200 é»ï¼ˆ**9.5x æå‡**ï¼‰
- **æ³¢é•·ç¯„åœ**: 400-700nmï¼ˆ+50% è¦†è“‹ï¼‰
- **ISO ç¯„åœ**: 50-6400ï¼ˆæ”¯æ´ä½ ISOï¼‰

#### `wavelength_bloom_params.use_mie_lookup` (Boolean)
å•Ÿç”¨/ç¦ç”¨ Mie æ•£å°„æŸ¥è¡¨ã€‚

```python
use_mie_lookup = False  # ä½¿ç”¨ç¶“é©—å…¬å¼ï¼ˆPhase 1ï¼Œå¿«é€Ÿï¼‰
use_mie_lookup = True   # ä½¿ç”¨ Mie æŸ¥è¡¨ï¼ˆPhase 5ï¼Œç²¾ç¢ºï¼‰
```

**å·®ç•°å°æ¯”**:

| ç‰¹æ€§ | ç¶“é©—å…¬å¼ (False) | Mie æŸ¥è¡¨ v2 (True) |
|------|-----------------|-------------------|
| **ç†è«–åŸºç¤** | Î· âˆ Î»â»Â³Â·âµ (Rayleigh-like) | å®Œæ•´ Mie ç†è«– + AgBr ç²’å­ |
| **è—å…‰æ•£å°„** | å¼·ï¼ˆÎ·_blue/Î·_red â‰ˆ 3.0xï¼‰ | å¼±ï¼ˆÎ·_blue/Î·_red â‰ˆ 0.14xï¼‰âš ï¸ |
| **è¨ˆç®—é€Ÿåº¦** | ~0.14s (2000Ã—3000) | ~0.14s (ç›¸åŒ) |
| **æ’å€¼èª¤å·®** | N/Aï¼ˆç„¡éœ€æ’å€¼ï¼‰ | å¹³å‡ 2.16%ï¼Œæœ€å¤§ 2.61% |
| **ç‰©ç†æº–ç¢ºæ€§** | è¿‘ä¼¼ | é«˜ï¼ˆMie æŒ¯ç›ªï¼‰ |

**é‡è¦æç¤º**: Mie ç†è«–ä¸‹ï¼ŒAgBr ç²’å­åœ¨å¯è¦‹å…‰æ³¢æ®µè™•æ–¼**æŒ¯ç›ªå€**ï¼Œå°è‡´è—å…‰æ•£å°„åè€Œæ¯”ç´…å…‰å¼±ï¼ˆé•å Rayleigh ç›´è¦ºï¼‰ã€‚é€™æ˜¯ç‰©ç†æ­£ç¢ºçš„è¡Œç‚ºï¼Œé bugã€‚

#### é¸æ“‡å»ºè­°

**ä½¿ç”¨ç¶“é©—å…¬å¼ (False) çš„æƒ…æ³**:
- âœ… éœ€è¦å‚³çµ±ã€Œè—è‰²å…‰æšˆã€æ•ˆæœï¼ˆInstagram é¢¨æ ¼ï¼‰
- âœ… è¿½æ±‚è¦–è¦ºä¸€è‡´æ€§ï¼ˆèˆ‡ Phase 1 ç›¸åŒï¼‰
- âœ… ä¸è¦æ±‚ç‰©ç†ç²¾ç¢ºæ€§
- âœ… å¿«é€Ÿæ¸¬è©¦/åŸå‹é–‹ç™¼

**ä½¿ç”¨ Mie æŸ¥è¡¨ (True) çš„æƒ…æ³**:
- âœ… éœ€è¦ç‰©ç†æº–ç¢ºçš„æ•£å°„ï¼ˆç§‘å­¸/ç ”ç©¶ï¼‰
- âœ… é¡˜æ„æ¥å—ã€Œé•åç›´è¦ºã€çš„å…‰æšˆé¡è‰²
- âœ… æ¢ç´¢çœŸå¯¦éŠ€é¹½æ•£å°„è¡Œç‚º
- âœ… ISO ä¾è³´çš„æ•£å°„è®ŠåŒ–

#### é…ç½®ç¯„ä¾‹

```python
from film_models import get_film_profile, PhysicsMode

# æ–¹æ¡ˆ A: ç¶“é©—å…¬å¼ï¼ˆå‚³çµ±è—è‰²å…‰æšˆï¼‰
film = get_film_profile("Portra400_MediumPhysics")
assert film.wavelength_bloom_params.use_mie_lookup == False
# é æœŸï¼šÎ·(450nm)/Î·(650nm) â‰ˆ 3.0ï¼ˆè—å…‰æ˜é¡¯ï¼‰

# æ–¹æ¡ˆ B: Mie æŸ¥è¡¨ v2ï¼ˆç‰©ç†æº–ç¢ºï¼‰
film = get_film_profile("Portra400_MediumPhysics_Mie")
assert film.wavelength_bloom_params.use_mie_lookup == True
# é æœŸï¼šÎ·(450nm)/Î·(650nm) â‰ˆ 0.14ï¼ˆç´…å…‰è¼ƒæ˜é¡¯ï¼‰
```

#### Mie æŸ¥è¡¨æŠ€è¡“è¦æ ¼

**æŸ¥è¡¨çµæ§‹** (`data/mie_lookup_table_v2.npz`):
```python
{
    'wavelengths': [400, 433.33, ..., 700] nm,  # 10 é»
    'iso_values': [50, 100, 125, ..., 6400],    # 20 é»
    'sigma': (10, 20),    # PSF æ ¸å¿ƒå¯¬åº¦ (â‰ˆ20pxï¼Œå¹¾ä¹ä¸è®Š)
    'kappa': (10, 20),    # PSF å°¾éƒ¨å°ºåº¦ (â‰ˆ30pxï¼Œå¹¾ä¹ä¸è®Š)
    'rho': (10, 20),      # æ ¸å¿ƒ/å°¾éƒ¨æ¯”ä¾‹ (â‰ˆ0.95ï¼Œå¹¾ä¹ä¸è®Š)
    'eta': (10, 20)       # èƒ½é‡æ¬Šé‡ (0.018-5.958ï¼Œå¼·çƒˆè®ŠåŒ–)
}
```

**æ’å€¼æ–¹æ³•**: é›™ç·šæ€§æ’å€¼ï¼ˆæ³¢é•· Ã— ISOï¼‰
**æ’å€¼ç²¾åº¦**:
- Ïƒ/Îº/Ï: < 0.01%ï¼ˆå¹¾ä¹å¸¸æ•¸ï¼‰
- **Î·: å¹³å‡ 2.16%ï¼Œæœ€å¤§ 2.61%**ï¼ˆé—œéµåƒæ•¸ï¼‰

**æ•ˆèƒ½åŸºæº–**:
- æŸ¥è¡¨è¼‰å…¥: 0.53 msï¼ˆé¦–æ¬¡ï¼Œå¿«å–å¾Œå¿½ç•¥ï¼‰
- å–®æ¬¡æ’å€¼: 0.0205 ms
- å½±åƒè™•ç†: ~0.14s (2000Ã—3000)

#### è¦–è¦ºé©—è­‰æ­¥é©Ÿ

1. å•Ÿå‹• UI: `streamlit run Phos_0.3.0.py`
2. ä¸Šå‚³æ¸¬è©¦å½±åƒï¼ˆå»ºè­°ï¼šè—å¤©ã€é€†å…‰ã€è·¯ç‡ˆï¼‰
3. é¸æ“‡ `Portra400_MediumPhysics`ï¼ˆç¶“é©—å…¬å¼ï¼‰è™•ç†
4. é¸æ“‡ `Portra400_MediumPhysics_Mie`ï¼ˆMie v2ï¼‰è™•ç†
5. å°æ¯”å…©è€…å·®ç•°ï¼š
   - **è—å…‰å…‰æšˆ**: Mie ç‰ˆæœ¬æ‡‰è¼ƒå¼±
   - **ç´…å…‰å…‰æšˆ**: Mie ç‰ˆæœ¬æ‡‰è¼ƒå¼·
   - **æ•´é«”èƒ½é‡**: æ‡‰ç›¸ä¼¼ï¼ˆèƒ½é‡å®ˆæ†ï¼‰

---

## è¦–è¦ºæ•ˆæœå°æ¯” Visual Comparison

### èƒ½é‡å®ˆæ†æ•ˆæœ Energy Conservation Effect

| æ¨¡å¼ | èƒ½é‡è®ŠåŒ– | è¦–è¦ºç‰¹å¾µ |
|-----|---------|---------|
| **Artistic** | +10% | é«˜å…‰æ›´äº®ã€æ›´ã€Œè¯éº—ã€ã€è¦–è¦ºè¡æ“Šå¼· |
| **Physical** | Â±0% | é«˜å…‰çœŸå¯¦ã€æŸ”å’Œæ•£å°„ã€è‡ªç„¶ |

**é¸æ“‡å»ºè­°**:
- ç¤¾äº¤åª’é«”ã€å¿«é€Ÿå‡ºåœ– â†’ Artisticï¼ˆæ›´è¨å–œï¼‰
- å°ˆæ¥­ä½œå“ã€ç§‘å­¸ç”¨é€” â†’ Physicalï¼ˆæ›´çœŸå¯¦ï¼‰

---

### H&D æ›²ç·šæ•ˆæœ H&D Curve Effect

| ç„¡ H&D | ä½ Gamma (0.6) | é«˜ Gamma (1.8) |
|-------|----------------|----------------|
| ç·šæ€§éŸ¿æ‡‰ | æŸ”å’Œã€å¯¬å®¹åº¦é«˜ | å°æ¯”å¼·ã€é®®è‰· |
| æš—éƒ¨æ˜“æ­»é»‘ | é™°å½±ç´°ç¯€è±å¯Œ | é™°å½±æ·±é‚ƒ |
| äº®éƒ¨æ˜“éæ› | é«˜å…‰ç´°ç¯€ä¿ç•™ | é«˜å…‰éŠ³åˆ© |

**èª¿æ•´æµç¨‹**:
1. **å…ˆèª¿ gamma**: æ±ºå®šæ•´é«”å°æ¯”åº¦
2. **å†èª¿ toe**: å¾®èª¿é™°å½±æŸ”å’Œåº¦
3. **æœ€å¾Œèª¿ shoulder**: å¾®èª¿é«˜å…‰å¯¬å®¹åº¦

---

### é¡†ç²’æ•ˆæœ Grain Effect

| è—è¡“æ¨¡å¼ | æ³Šæ¾æ¨¡å¼ |
|---------|---------|
| ä¸­èª¿é¡†ç²’æœ€æ˜é¡¯ | æš—éƒ¨é¡†ç²’æœ€æ˜é¡¯ |
| è¦–è¦ºå‡å‹» | ç‰©ç†çµ±è¨ˆï¼ˆSNR âˆ âˆšæ›å…‰ï¼‰|
| è¨å–œã€æŸ”å’Œ | çœŸå¯¦ã€ç²—ç³™ |

**å¯¦æ¸¬æ•¸æ“š**:
```
å€åŸŸ      è—è¡“æ¨¡å¼ SNR    æ³Šæ¾æ¨¡å¼ SNR
æš—éƒ¨(0.1)    0.80           0.15   â† æ³Šæ¾æ›´æ˜é¡¯
ä¸­èª¿(0.5)    0.25           0.71   â† è—è¡“æ›´æ˜é¡¯
äº®éƒ¨(0.9)    0.88           2.86   â† æ³Šæ¾æ›´ä¹¾æ·¨
```

---

## å¸¸è¦‹å•é¡Œ FAQ

### Q1: ç‰©ç†æ¨¡å¼æœƒä¸æœƒè®“ç…§ç‰‡è®Šã€Œé†œã€ï¼Ÿ
**A**: ä¸æœƒï¼Œä½†é¢¨æ ¼ä¸åŒã€‚
- **è—è¡“æ¨¡å¼**: æ›´ã€Œè¯éº—ã€ã€é£½å’Œåº¦é«˜ã€è¦–è¦ºè¡æ“Šå¼·ï¼ˆInstagram é¢¨æ ¼ï¼‰
- **ç‰©ç†æ¨¡å¼**: æ›´ã€ŒçœŸå¯¦ã€ã€æŸ”å’Œã€ç´°ç¯€è±å¯Œï¼ˆå°ˆæ¥­è† ç‰‡é¢¨æ ¼ï¼‰

é¸æ“‡å“ªç¨®å–æ±ºæ–¼ä½ çš„éœ€æ±‚ï¼šå¿«é€Ÿå‡ºåœ–ç”¨è—è¡“ï¼Œå°ˆæ¥­ä½œå“ç”¨ç‰©ç†ã€‚

---

### Q2: å¯ä»¥æ··æ­è—è¡“èˆ‡ç‰©ç†ç‰¹æ€§å—ï¼Ÿ
**A**: å¯ä»¥ï¼ä½¿ç”¨ `HYBRID` æ¨¡å¼ã€‚

```python
film.physics_mode = PhysicsMode.HYBRID

# ä¾‹å­ï¼šH&D æ›²ç·šç”¨ç‰©ç†ï¼ˆæŸ”å’Œéæ¸¡ï¼‰ï¼Œé¡†ç²’ç”¨è—è¡“ï¼ˆä¸­èª¿æ˜é¡¯ï¼‰
film.hd_curve_params.enabled = True
film.bloom_params.mode = "physical"
film.grain_params.mode = "artistic"
```

---

### Q3: æ•ˆèƒ½å½±éŸ¿æœ‰å¤šå¤§ï¼Ÿ
**A**: å¾ˆå°ï¼Œç´„ +8%ã€‚

| å½±åƒå°ºå¯¸ | è—è¡“æ¨¡å¼ | ç‰©ç†æ¨¡å¼ | å¢åŠ  |
|---------|---------|---------|-----|
| 2000Ã—3000 | 0.7s | 0.8s | +0.1s |
| 4000Ã—6000 | 2.8s | 3.0s | +0.2s |

ä¸»è¦é–‹éŠ·ä¾†è‡ªï¼š
- H&D æ›²ç·šçš„ `log10` é‹ç®—ï¼ˆ~0.05sï¼‰
- Poisson å™ªè²çš„æ­£æ…‹éš¨æ©Ÿæ•¸ï¼ˆ~0.03sï¼‰
- PSF æ­£è¦åŒ–ï¼ˆå¹¾ä¹ç„¡é–‹éŠ·ï¼‰

---

### Q4: ç‚ºä»€éº¼è—è¡“æ¨¡å¼çš„ Bloom æœƒé•åèƒ½é‡å®ˆæ†ï¼Ÿ
**A**: è¨­è¨ˆå–æ¨ã€‚

è—è¡“æ¨¡å¼çš„ Bloom ç›´æ¥ã€Œç–ŠåŠ ã€æ•£å°„å…‰ï¼Œé¡ä¼¼ Photoshop çš„ "Screen" æ··åˆæ¨¡å¼ï¼š
```python
result = original + bloom * strength  # èƒ½é‡å¢åŠ 
```

ç‰©ç†æ¨¡å¼å‰‡ã€Œé‡æ–°åˆ†é…ã€èƒ½é‡ï¼š
```python
result = original - scattered_energy + bloom  # èƒ½é‡å®ˆæ†
```

é€™è®“ç‰©ç†æ¨¡å¼çš„ Bloom æ›´æŸ”å’Œã€è‡ªç„¶ï¼Œä½†è—è¡“æ¨¡å¼çš„ Bloom æ›´ã€Œè¯éº—ã€ã€‚

---

### Q5: H&D æ›²ç·šçš„ gamma èˆ‡é¡¯ç¤º gamma 2.2 æœ‰ä»€éº¼ä¸åŒï¼Ÿ
**A**: å®Œå…¨ä¸åŒçš„æ¦‚å¿µï¼

| é¡å‹ | å®šç¾© | å…¸å‹å€¼ | ç”¨é€” |
|-----|------|-------|------|
| **è† ç‰‡ gamma** | H&D æ›²ç·šæ–œç‡ | 0.6-2.0 | æ±ºå®šè† ç‰‡å°æ¯”åº¦ |
| **é¡¯ç¤º gamma** | è¢å¹•éŸ¿æ‡‰æ›²ç·š | 2.2 (sRGB) | æ ¡æ­£ CRT éç·šæ€§ |

**ä¸è¦æ··æ·†**ï¼è† ç‰‡ gamma 0.6 æ˜¯ã€Œä½å°æ¯”ã€ï¼Œé¡¯ç¤º gamma 2.2 æ˜¯ã€Œæ¨™æº–è¢å¹•ã€ã€‚

---

### Q6: æ³Šæ¾æ¨¡å¼çš„é¡†ç²’ç‚ºä»€éº¼åœ¨æš—éƒ¨æ›´æ˜é¡¯ï¼Ÿ
**A**: é€™æ˜¯å…‰å­çµ±è¨ˆçš„ç‰©ç†ç‰¹æ€§ã€‚

```
ä¿¡å™ªæ¯” SNR = âˆšÎ» (Î» = æ›å…‰é‡ âˆ å…‰å­æ•¸)

æš—éƒ¨: Î» = 100 photons â†’ SNR = 10 â†’ ç›¸å°èª¤å·® 10%ï¼ˆæ˜é¡¯ï¼‰
äº®éƒ¨: Î» = 10000 photons â†’ SNR = 100 â†’ ç›¸å°èª¤å·® 1%ï¼ˆä¸æ˜é¡¯ï¼‰
```

é€™å°±æ˜¯ç‚ºä»€éº¼çœŸå¯¦è† ç‰‡çš„æš—éƒ¨ç¸½æ˜¯ã€Œé¡†ç²’ç²—ç³™ã€ï¼Œè€Œäº®éƒ¨ã€Œç´°è†©å¹³æ»‘ã€ã€‚

---

### Q7: æˆ‘è©²å¦‚ä½•é¸æ“‡åº•ç‰‡é…ç½®ï¼Ÿ
**A**: ä¾å ´æ™¯é¸æ“‡ï¼Œç„¶å¾Œå•Ÿç”¨ç‰©ç†æ¨¡å¼å¾®èª¿ã€‚

| åº•ç‰‡ | é¢¨æ ¼ | æ¨è–¦å ´æ™¯ | ç‰©ç†æ¨¡å¼å»ºè­° |
|-----|------|---------|-------------|
| **NC200** | æ¸…æ–°ã€è‡ªç„¶ | æ—¥å¸¸ã€äººåƒ | gamma=0.65, toe=2.0 |
| **Portra400** | æŸ”å’Œã€ä½å°æ¯” | å°ˆæ¥­äººåƒ | gamma=0.62, shoulder=2.0 |
| **Ektar100** | é®®è‰·ã€ç´°è†© | é¢¨æ™¯ã€å»ºç¯‰ | gamma=0.70, grain_size=0.8 |
| **Cinestill800T** | é›»å½±æ„Ÿã€å¼·å…‰æšˆ | å¤œæ™¯ã€è¡—æ‹ | bloom.scattering_ratio=0.25 |
| **AS100** | ç´°è†©é»‘ç™½ | é¢¨æ™¯ã€éœç‰© | grain_size=0.5, intensity=0.3 |
| **HP5Plus400** | ç¶“å…¸é»‘ç™½ | è¡—æ‹ã€ç´€å¯¦ | grain_size=1.5, intensity=1.0 |

---

### Q8: å¦‚ä½•é©—è­‰ç‰©ç†æ¨¡å¼æ­£ç¢ºé‹ä½œï¼Ÿ
**A**: é‹è¡Œæ¸¬è©¦å¥—ä»¶ã€‚

```bash
# èƒ½é‡å®ˆæ†æ¸¬è©¦
python3 tests/test_energy_conservation.py
# é æœŸ: ç‰©ç†æ¨¡å¼èª¤å·® < 0.01%

# H&D æ›²ç·šæ¸¬è©¦
python3 tests/test_hd_curve.py
# é æœŸ: å°æ•¸å–®èª¿æ€§ã€Toe/Shoulder æ•ˆæœ

# æ³Šæ¾é¡†ç²’æ¸¬è©¦
python3 tests/test_poisson_grain.py
# é æœŸ: æš—éƒ¨ SNR < äº®éƒ¨ SNR

# æ•´åˆæ¸¬è©¦
python3 tests/test_integration.py
# é æœŸ: 26/26 tests passed
```

---

## æŠ€è¡“ç´°ç¯€ Technical Details

### æª”æ¡ˆçµæ§‹ File Structure

```
Phos/
â”œâ”€â”€ Phos_0.2.0.py              # ä¸»ç¨‹å¼ï¼ˆå«ç‰©ç†æ¨¡å¼å¯¦ä½œï¼‰
â”‚   â”œâ”€â”€ spectral_response()    # Line 370ï¼ˆå‰èº« luminanceï¼‰
â”‚   â”œâ”€â”€ apply_bloom_conserved()# Line 780ï¼ˆèƒ½é‡å®ˆæ† Bloomï¼‰
â”‚   â”œâ”€â”€ apply_hd_curve()       # Line 850ï¼ˆH&D æ›²ç·šï¼‰
â”‚   â”œâ”€â”€ generate_poisson_grain()# Line 480ï¼ˆæ³Šæ¾é¡†ç²’ï¼‰
â”‚   â””â”€â”€ optical_processing()   # Line 973ï¼ˆæ•´åˆæµç¨‹ï¼‰
â”‚
â”œâ”€â”€ film_models.py             # åº•ç‰‡åƒæ•¸å®šç¾©
â”‚   â”œâ”€â”€ PhysicsMode            # åˆ—èˆ‰: ARTISTIC/PHYSICAL/HYBRID
â”‚   â”œâ”€â”€ HDCurveParams          # H&D æ›²ç·šåƒæ•¸
â”‚   â”œâ”€â”€ BloomParams            # Bloom åƒæ•¸
â”‚   â”œâ”€â”€ GrainParams            # é¡†ç²’åƒæ•¸
â”‚   â””â”€â”€ FilmProfile            # åº•ç‰‡å®Œæ•´é…ç½®
â”‚
â”œâ”€â”€ tests/                     # æ¸¬è©¦å¥—ä»¶
â”‚   â”œâ”€â”€ test_energy_conservation.py  # èƒ½é‡å®ˆæ†ï¼ˆ5 testsï¼‰
â”‚   â”œâ”€â”€ test_hd_curve.py             # H&D æ›²ç·šï¼ˆ8 testsï¼‰
â”‚   â”œâ”€â”€ test_poisson_grain.py        # æ³Šæ¾é¡†ç²’ï¼ˆ7 testsï¼‰
â”‚   â””â”€â”€ test_integration.py          # æ•´åˆæ¸¬è©¦ï¼ˆ6 testsï¼‰
â”‚
â””â”€â”€ context/                   # æ±ºç­–èˆ‡å¯©æŸ¥è¨˜éŒ„
    â”œâ”€â”€ decisions_log.md       # æŠ€è¡“æ±ºç­–æ—¥èªŒ
    â””â”€â”€ PHYSICS_REVIEW.md      # ç‰©ç†å¯©æŸ¥å ±å‘Šï¼ˆ30 é ï¼‰
```

---

### å‡½æ•¸èª¿ç”¨æµç¨‹ Function Call Flow

```python
# 1. è¼‰å…¥åº•ç‰‡é…ç½®
film = get_film_profile("NC200")
film.physics_mode = PhysicsMode.PHYSICAL

# 2. å…‰è­œéŸ¿æ‡‰è¨ˆç®—ï¼ˆæ›¿ä»£åŸ luminanceï¼‰
response_r, response_g, response_b, response_total = spectral_response(image, film)
# å¯¦ä½œï¼šR/G/B ä¸‰å±¤ä¹³åŠ‘çš„å…‰è­œéŸ¿æ‡‰æ¬Šé‡çŸ©é™£ä¹˜æ³•

# 3. å…‰å­¸è™•ç†æµç¨‹
result = optical_processing(response_r, response_g, response_b, response_total, film, ...)

# å…§éƒ¨æµç¨‹ï¼š
# 3.1 çµ„åˆä¸‰å±¤ï¼ˆç´…/ç¶ /è—ä¹³åŠ‘ï¼‰
combined = combine_emulsion_layers(response_r, response_g, response_b, film)

# 3.2 Bloom æ•ˆæœ
if film.bloom_params.mode == "physical":
    combined = apply_bloom_conserved(combined, film.bloom_params, ...)
else:
    combined = apply_bloom_artistic(combined, film.bloom_params, ...)

# 3.3 é¡†ç²’å™ªè²
if film.grain_params.mode == "poisson":
    grain = generate_poisson_grain(response_r/g/b, film.grain_params)
else:
    grain = generate_artistic_grain(combined, film.grain_params)
combined = combined + grain

# 3.4 H&D æ›²ç·šï¼ˆåƒ…ç‰©ç†/æ··åˆæ¨¡å¼ï¼‰
if film.hd_curve_params.enabled:
    combined = apply_hd_curve(combined, film.hd_curve_params)

# 3.5 è‰²èª¿æ˜ å°„ï¼ˆæœ€çµ‚è¼¸å‡ºï¼‰
result = apply_tone_mapping(combined, tone_style)
```

---

### æ¸¬è©¦è¦†è“‹ç‡ Test Coverage

| æ¸¬è©¦é¡åˆ¥ | æª”æ¡ˆ | æ¸¬è©¦æ•¸ | è¦†è“‹åŠŸèƒ½ |
|---------|------|-------|---------|
| **èƒ½é‡å®ˆæ†** | `test_energy_conservation.py` | 5 | PSF æ­£è¦åŒ–ã€èƒ½é‡è¨ˆç®—ã€è—è¡“vsç‰©ç†å°æ¯” |
| **H&D æ›²ç·š** | `test_hd_curve.py` | 8 | å°æ•¸éŸ¿æ‡‰ã€Toe/Shoulderã€Gammaã€å‹•æ…‹ç¯„åœ |
| **æ³Šæ¾é¡†ç²’** | `test_poisson_grain.py` | 7 | Poisson çµ±è¨ˆã€SNRã€ç©ºé–“ç›¸é—œã€è—è¡“vsç‰©ç† |
| **æ•´åˆæ¸¬è©¦** | `test_integration.py` | 6 | å®Œæ•´æµç¨‹ã€æ¨¡å¼åˆ‡æ›ã€FilmProfile è¼‰å…¥ |
| **ç¸½è¨ˆ** | - | **26** | **100% æ ¸å¿ƒåŠŸèƒ½è¦†è“‹** |

**é‹è¡Œæ¸¬è©¦**:
```bash
cd /Users/latteine/Documents/coding/Phos
python3 tests/test_energy_conservation.py  # ~2s
python3 tests/test_hd_curve.py             # ~3s
python3 tests/test_poisson_grain.py        # ~4s
python3 tests/test_integration.py          # ~5s
```

---

### å·²çŸ¥é™åˆ¶èˆ‡æœªä¾†æ”¹é€² Known Limitations & Future Improvements

#### ç•¶å‰é™åˆ¶ Current Limitations

1. **H&D æ›²ç·šç°¡åŒ–**:
   - ä½¿ç”¨ Sigmoidï¼ˆToeï¼‰+ Exponentialï¼ˆShoulderï¼‰è¿‘ä¼¼
   - çœŸå¯¦ H&D æ›²ç·šæ›´è¤‡é›œï¼ˆåŒ–å­¸åæ‡‰å‹•åŠ›å­¸ï¼‰
   - **å½±éŸ¿**: æ¥µç«¯æ›å…‰é‡æ™‚ç²¾åº¦ç•¥é™ï¼ˆÂ±5%ï¼‰

2. **Poisson æ­£æ…‹è¿‘ä¼¼**:
   - Î» < 20 æ™‚ç²¾åº¦é™ä½ï¼ˆä½¿ç”¨æ­£æ…‹åˆ†å¸ƒè¿‘ä¼¼ï¼‰
   - **å½±éŸ¿**: æ¥µæš—å€åŸŸï¼ˆæ›å…‰ < 0.05ï¼‰å™ªè²ç•¥ä½ä¼°

3. **Bloom PSF æ¨¡å‹**:
   - ä½¿ç”¨ç¶“é©— Gaussian/Exponential
   - çœŸå¯¦æ•£å°„éœ€å®Œæ•´ Mie ç†è«– + Halation å±¤
   - **å½±éŸ¿**: é•·è·é›¢æ•£å°„å°¾éƒ¨ç•¥çŸ­ï¼ˆè¦–è¦ºå·®ç•°å°ï¼‰

4. **UI æ”¯æ´**:
   - ç•¶å‰éœ€ä»£ç¢¼é…ç½®
   - Streamlit UI å°šæœªæ•´åˆç‰©ç†æ¨¡å¼é–‹é—œ

#### è¨ˆåŠƒæ”¹é€² Planned Improvements

**v0.2.1 (çŸ­æœŸ)**:
- âœ… Streamlit UI æ·»åŠ  Physics Mode é–‹é—œ
- âœ… åƒæ•¸æ»‘æ¡¿ï¼ˆGamma, Toe, Shoulder, Grain Sizeï¼‰
- âœ… è—è¡“ vs ç‰©ç†å³æ™‚å°æ¯”è¦–åœ–

**v0.3.0 (ä¸­æœŸ)**:
- âœ… **Phase 5.5: Mie æ•£å°„é«˜å¯†åº¦æŸ¥è¡¨ v2**ï¼ˆ2025-12-20ï¼‰
  - æ ¼é»å¯†åº¦ï¼š21 â†’ 200 é»ï¼ˆ9.5x æå‡ï¼‰
  - Î· æ’å€¼èª¤å·®ï¼š155% â†’ 2.16%ï¼ˆ72x æ”¹å–„ï¼‰
  - æ³¢é•·è¦†è“‹ï¼š400-700nmï¼ˆ+50% ç¯„åœï¼‰
  - æ”¯æ´ ISO 50-6400
- âœ… æ³¢é•·ä¾è³´æ•£å°„ï¼ˆç´…å…‰ > è—å…‰ï¼Œç¶“é©—å…¬å¼ & Mie ç†è«–ï¼‰
- âœ… Halation ç¨ç«‹å»ºæ¨¡ï¼ˆBeer-Lambert é€éç‡ï¼‰
- ğŸ”² H&D æ›²ç·š YAML/JSON å°å…¥ï¼ˆè‡ªå®šç¾©åº•ç‰‡ï¼‰
- ğŸ”² åœ–å±¤æ··åˆç‰©ç†æ¨¡å¼ï¼ˆæ¬Šé‡æ­£è¦åŒ–ï¼‰

**v0.4.0 (é•·æœŸ)**:
- ğŸ”² å®Œæ•´ Radiative Transfer Equationï¼ˆRTEï¼‰æ±‚è§£å™¨
- ğŸ”² çœŸå¯¦ ISO æ„Ÿå…‰åº¦è¨ˆç®—ï¼ˆæ›å…‰ä¸‰è§’å½¢ï¼‰
- ğŸ”² äº’æ˜“å¾‹å¤±æ•ˆæ¨¡æ“¬ï¼ˆReciprocity Failureï¼‰
- ğŸ”² è‰²æº«ä¾è³´é¡è‰²è½‰æ›ï¼ˆTungsten/Daylightï¼‰

---

## åƒè€ƒè³‡æº References

### å­¸è¡“æ–‡ç» Academic Papers
1. **Beer-Lambert Law**: I = Iâ‚€ Ã— e^(-Î±x)
2. **Radiative Transfer Equation**: dL/ds = -Ïƒ_t L + Ïƒ_s âˆ« p(Ï‰, Ï‰') L dÏ‰'
3. **H&D Curve Theory**: Hurter & Driffield (1890), "Photochemical Investigations"
4. **Poisson Statistics**: P(k; Î») = (Î»^k Ã— e^(-Î»)) / k!

### æŠ€è¡“æ–‡æª” Technical Documentation
- **ç‰©ç†å¯©æŸ¥å ±å‘Š**: `PHYSICS_REVIEW.md`ï¼ˆ30 é å®Œæ•´åˆ†æï¼‰
- **æ±ºç­–æ—¥èªŒ**: `context/decisions_log.md`ï¼ˆæ‰€æœ‰æŠ€è¡“æ±ºç­–ï¼‰
- **æ¸¬è©¦å ±å‘Š**: `tests/` ç›®éŒ„ï¼ˆ26 é …æ¸¬è©¦ï¼‰

### å¤–éƒ¨è³‡æº External Resources
- [Kodak: Film Sensitometry](https://www.kodak.com/)
- [Ilford: Characteristic Curves](https://www.ilfordphoto.com/)
- [Wikipedia: Film Grain](https://en.wikipedia.org/wiki/Film_grain)
- [Charles Poynton: Gamma FAQ](http://poynton.ca/GammaFAQ.html)

---

## ç‰ˆæœ¬æ­·å² Version History

### v0.3.0 (2025-12-20) - Medium Physics Upgrade
- âœ… **Phase 5.5: Mie æ•£å°„é«˜å¯†åº¦æŸ¥è¡¨ v2**
  - æ ¼é»å¯†åº¦ï¼š21 â†’ 200ï¼ˆ9.5xï¼‰
  - Î· æ’å€¼èª¤å·®ï¼š155% â†’ 2.16%ï¼ˆ72x æ”¹å–„ï¼‰
  - æ³¢é•·ç¯„åœï¼š400-700nmï¼ˆ+50%ï¼‰
  - æª”æ¡ˆå¤§å°ï¼š2.2KB â†’ 5.9KBï¼ˆå¯æ¥å—ï¼‰
- âœ… æ³¢é•·ä¾è³´æ•£å°„ï¼ˆç¶“é©—å…¬å¼ & Mie ç†è«–é›™é¸é …ï¼‰
- âœ… Halation ç¨ç«‹å»ºæ¨¡ï¼ˆBeer-Lambert é€éç‡ï¼‰
- âœ… åˆ†é›¢ Bloomï¼ˆä¹³åŠ‘å…§ï¼‰èˆ‡ Halationï¼ˆèƒŒå±¤åå°„ï¼‰
- âœ… ä¸‰å€‹æ¸¬è©¦é…ç½®ï¼ˆPortra400/Cinestill800Tï¼Œå« Mie ç‰ˆæœ¬ï¼‰

### v0.2.0 (2025-12-19) - Initial Physical Mode Release
- âœ… ä¸‰ç¨®æ¨¡å¼ï¼šARTISTIC / PHYSICAL / HYBRID
- âœ… èƒ½é‡å®ˆæ† Bloomï¼ˆPSF æ­£è¦åŒ–ï¼‰
- âœ… H&D ç‰¹æ€§æ›²ç·šï¼ˆå°æ•¸ + Toe + Shoulderï¼‰
- âœ… æ³Šæ¾é¡†ç²’å™ªè²ï¼ˆå…‰å­çµ±è¨ˆï¼‰
- âœ… èªç¾©é‡æ–°å‘½åï¼ˆ`spectral_response` å–ä»£ `luminance`ï¼‰
- âœ… å®Œæ•´æ¸¬è©¦å¥—ä»¶ï¼ˆ26/26 testsï¼‰

### v0.2.1 (è¨ˆåŠƒä¸­) - UI Integration
- ğŸ”² Streamlit UI Physics Mode é–‹é—œ
- ğŸ”² åƒæ•¸èª¿æ•´æ»‘æ¡¿
- ğŸ”² å³æ™‚å°æ¯”è¦–åœ–

---

## è²¢ç»èˆ‡åé¥‹ Contribution & Feedback

### å›å ±å•é¡Œ Report Issues
å¦‚æœæ‚¨ç™¼ç¾ç‰©ç†æ¨¡å¼çš„å•é¡Œæˆ–æœ‰æ”¹é€²å»ºè­°ï¼š
- ğŸ“§ **Email**: lyco_p@163.com
- ğŸ› **GitHub Issues**: https://github.com/LYCO6273/Phos/issues

### æ¸¬è©¦åé¥‹ Testing Feedback
æ­¡è¿åˆ†äº«æ‚¨çš„æ¸¬è©¦çµæœï¼š
- èƒ½é‡å®ˆæ†èª¤å·®
- H&D æ›²ç·šåƒæ•¸çµ„åˆ
- æ³Šæ¾é¡†ç²’æ•ˆæœå°æ¯”
- æ•ˆèƒ½åŸºæº–æ¸¬è©¦

### è²¢ç»ä»£ç¢¼ Code Contribution
1. Fork å°ˆæ¡ˆ
2. å‰µå»º feature branch
3. ç¢ºä¿æ¸¬è©¦é€šéï¼ˆ26/26ï¼‰
4. æäº¤ Pull Request

---

**æœ€å¾Œæ›´æ–°**: 2025-12-19  
**ç¶­è­·è€…**: @LYCO6273  
**æˆæ¬Š**: AGPL-3.0

---

**ç¥ä½ æ‹å‡ºç¾éº—çš„ç…§ç‰‡ï¼ Happy shooting! ğŸ“·âœ¨**
