# TASK-001: v0.2.0 功能驗證測試

**任務 ID**: TASK-001  
**建立時間**: 2025-12-19 15:45  
**負責人**: Main Agent  
**狀態**: 🔄 進行中  
**優先級**: 🔴 高（阻塞後續物理模型改進）

---

## 📋 任務目標

驗證 v0.2.0 的核心功能（批次處理、ZIP 下載、UI 互動）是否正常運作，確保發布版本可用。

**成功指標**:
1. ✅ 單張照片處理無錯誤
2. ✅ 批次處理（2 張、10 張）成功
3. ✅ ZIP 下載檔案完整
4. ✅ UI 在不同螢幕寬度下正常顯示
5. ✅ 錯誤處理（上傳非圖片檔案）不導致崩潰

**失敗條件**:
- 任何功能導致程式崩潰
- 批次處理產生的照片與單張處理結果明顯不一致
- ZIP 檔案損壞或無法解壓縮
- UI 在窄螢幕下重疊或無法操作

---

## 🎯 驗收標準

### 1. 單張照片處理（Smoke Test）
- [ ] 上傳任意 JPG/PNG 照片
- [ ] 選擇任一底片（如 Kodak Portra 400）
- [ ] 點擊「開始處理」按鈕
- [ ] 預覽圖正常顯示
- [ ] 下載按鈕出現且可下載

**預期結果**: 無錯誤訊息，處理時間 < 10 秒（2000×3000 照片）

### 2. 批次處理（小批次）
- [ ] 上傳 2 張照片
- [ ] 選擇「批次處理模式」
- [ ] 選擇底片並處理
- [ ] 進度條正常更新（0% → 50% → 100%）
- [ ] 顯示預覽（前 2 張）
- [ ] 「下載全部（ZIP）」按鈕出現

**預期結果**: 每張照片處理時間與單張模式相近，總時間約 2×單張時間

### 3. 批次處理（中批次）
- [ ] 上傳 10 張照片
- [ ] 重複上述流程
- [ ] ZIP 檔案大小合理（約 10×單張檔案大小）

**預期結果**: 不會記憶體溢位（OOM），進度條平滑更新

### 4. ZIP 下載驗證
- [ ] 下載批次處理的 ZIP 檔案
- [ ] 解壓縮檔案
- [ ] 檢查照片數量正確
- [ ] 檢查檔名格式（應為 `processed_<原檔名>.jpg`）
- [ ] 隨機開啟 2-3 張照片，確認可正常顯示

**預期結果**: ZIP 無損壞，所有照片可開啟

### 5. UI 響應式測試
- [ ] 在寬螢幕（> 1200px）測試
- [ ] 在窄螢幕（< 768px）測試
- [ ] 檢查按鈕、上傳區域、預覽區域是否重疊或錯位

**預期結果**: 所有元素可見且可操作

### 6. 錯誤處理測試
- [ ] 上傳 TXT 檔案（非圖片）
- [ ] 上傳損壞的圖片檔案
- [ ] 檢查是否顯示友善錯誤訊息（而非 Python traceback）

**預期結果**: 顯示錯誤提示，不崩潰

---

## 📥 輸入資料

### 測試用照片
**來源**: 用戶需提供或從測試資料集準備  
**規格**:
- 格式: JPG/PNG
- 解析度: 建議 2000×3000 或更高（模擬真實使用場景）
- 數量: 至少 10 張

**備選方案**: 若無測試照片，可使用 NumPy 生成合成圖片：
```python
import numpy as np
from PIL import Image

# 生成 3000×2000 的隨機圖片
img = np.random.randint(0, 256, (2000, 3000, 3), dtype=np.uint8)
Image.fromarray(img).save('test_image.jpg')
```

---

## 🔧 執行步驟

### Phase 1: 環境準備
1. 確認依賴已安裝：
   ```bash
   pip install -r requirements.txt
   ```
2. 啟動應用程式：
   ```bash
   streamlit run Phos_0.2.0.py
   ```
3. 在瀏覽器開啟 `http://localhost:8501`

### Phase 2: 手動測試
依序執行「驗收標準」中的 6 項測試，記錄結果於下方「測試結果」區塊。

### Phase 3: 自動化測試（可選）
若手動測試通過，可考慮撰寫自動化測試腳本：
```python
# tests/test_v020_integration.py
import pytest
from phos_batch import BatchProcessor
from film_models import FILM_PRESETS

def test_batch_processing():
    processor = BatchProcessor()
    images = [...]  # 載入測試圖片
    results = processor.process_batch_sequential(images, FILM_PRESETS['kodak_portra_400'])
    assert len(results) == len(images)
    assert all(r[2] is None for r in results)  # 無錯誤
```

### Phase 4: 結果彙整
將所有測試結果寫入 `test_report.md`。

---

## 📊 測試結果（待填寫）

### Test #1: 單張照片處理
**執行時間**: [待記錄]  
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- 處理時間: ___ 秒
- 記憶體使用: ___ MB
- 錯誤訊息: 無 / [描述]

### Test #2: 批次處理（2 張）
**執行時間**: [待記錄]  
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- 總處理時間: ___ 秒
- 平均每張: ___ 秒
- 進度條更新: 正常 / 異常

### Test #3: 批次處理（10 張）
**執行時間**: [待記錄]  
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- 總處理時間: ___ 秒
- 記憶體峰值: ___ MB
- 是否有 OOM: 否 / 是

### Test #4: ZIP 下載
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- ZIP 檔案大小: ___ MB
- 解壓縮成功: 是 / 否
- 照片完整性: 完整 / 損壞

### Test #5: UI 響應式
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- 寬螢幕（1920px）: 正常 / 異常
- 窄螢幕（768px）: 正常 / 異常
- 發現的問題: [描述]

### Test #6: 錯誤處理
**狀態**: [ ] ✅ 通過 / [ ] ❌ 失敗  
**觀察**:
- 上傳 TXT: 顯示錯誤提示 / 崩潰
- 上傳損壞圖片: 顯示錯誤提示 / 崩潰

---

## 🐛 發現的問題（Bug Tracker）

### Bug #1: [標題]
**嚴重度**: 🔴 Critical / 🟠 Major / 🟡 Minor  
**重現步驟**:
1. [步驟 1]
2. [步驟 2]

**預期行為**: [描述]  
**實際行為**: [描述]  
**錯誤訊息**: 
```
[貼上 traceback]
```

**暫時解決方案**: [如有]  
**根本原因**: [如已分析]  
**修復計畫**: [下一步]

---

## ⏱️ 時間盒

**預估時間**: 2-3 小時  
**實際時間**: [待記錄]  

**時間分配**:
- 環境準備: 15 分鐘
- 手動測試: 90 分鐘
- 問題分析: 30 分鐘
- 報告撰寫: 30 分鐘

**時間盒規則**: 若超過 4 小時仍未完成，暫停測試，彙整已知問題，請求用戶決定優先級。

---

## 🔄 後續行動

### 若測試全部通過
1. 更新 `context_session_20251219.md` 標記 v0.2.0 驗證完成
2. 與用戶討論物理模型改進方向（Path A/B/C）
3. 創建 TASK-002 或 TASK-003

### 若發現 Critical Bug
1. 立即暫停測試
2. 創建緊急修復任務（TASK-001-hotfix）
3. 考慮回退至 v0.1.3（若 bug 影響核心功能）

### 若發現 Minor Bug
1. 完成所有測試
2. 將 bug 列表記錄於 `context/decisions_log.md`
3. 在後續版本修復（v0.2.1）

---

## 📎 相關檔案

- **待測試程式**: `Phos_0.2.0.py`, `phos_batch.py`
- **參考文檔**: `TESTING_GUIDE_v0.2.0.md`
- **穩定版本**: `Phos_0.1.3.py` (若需回滾)
- **測試報告**: `tasks/TASK-001-v020-verification/test_report.md` (待建立)

---

## ✅ 完成條件

- [ ] 所有 6 項驗收標準測試完成
- [ ] 測試結果記錄於 `test_report.md`
- [ ] 發現的 bug 記錄並分類
- [ ] `context_session_20251219.md` 已更新
- [ ] `decisions_log.md` 已記錄測試決策

**簽核**: 待主 Agent 確認

---

**最後更新**: 2025-12-19 15:45  
**下一步**: 等待用戶提供測試照片或許可使用合成圖片進行測試
