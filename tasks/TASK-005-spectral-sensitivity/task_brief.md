# TASK-005: P0-2 å…‰è­œæ•æ„Ÿåº¦æ›²ç·šéåº¦ç°¡åŒ–ä¿®æ­£

**å‰µå»ºæ—¥æœŸ**: 2025-12-20  
**å„ªå…ˆç´š**: P0 (é—œéµç‰©ç†éŒ¯èª¤)  
**é ä¼°æ™‚é–“**: 3-4 å°æ™‚  
**ç‹€æ…‹**: Planning

---

## ğŸ“‹ ä»»å‹™ç›®æ¨™

ä¿®æ­£è† ç‰‡å…‰è­œæ•æ„Ÿåº¦æ›²ç·šçš„éåº¦ç°¡åŒ–å•é¡Œï¼Œå¾ã€Œå¤šé«˜æ–¯æ··åˆè¿‘ä¼¼ã€å‡ç´šåˆ°ã€ŒçœŸå¯¦å» å•†æ•¸æ“šæˆ–æ›´ç²¾ç¢ºå»ºæ¨¡ã€ã€‚

### é©—æ”¶æ¨™æº–

1. **ç‰©ç†æ­£ç¢ºæ€§**ï¼š
   - âœ… å…‰è­œæ›²ç·šå…·å¤šå³°çµæ§‹ï¼ˆä¸»å³° + æ¬¡å³°ï¼‰
   - âœ… éå°ç¨±å½¢ç‹€ï¼ˆç´…å±¤å·¦åã€ç¶ /è—å±¤å³åï¼‰
   - âœ… å±¤é–“é‡ç–Šåˆç†ï¼ˆäº¤å‰æ•æ„Ÿåº¦æ¨¡æ“¬å¯¬å®¹åº¦ï¼‰

2. **è‰²å½©æº–ç¢ºåº¦**ï¼š
   - âœ… ColorChecker 24 å¾€è¿”æ¸¬è©¦ï¼šÎ”E00 å¹³å‡ < 5.0
   - âœ… ColorChecker 24 æœ€å¤§èª¤å·®ï¼šÎ”E00 < 8.0
   - âœ… è† ç‰‡ç‰¹æœ‰è‰²ç›¸åç§»ä¿ç•™ï¼ˆå¦‚ Velvia é£½å’Œç¶ ã€Portra è†šè‰²å„ªåŒ–ï¼‰

3. **æ¸¬è©¦è¦†è“‹**ï¼š
   - âœ… æ–°å¢ `test_spectral_sensitivity.py`ï¼ˆæ›²ç·šå½¢ç‹€ã€å³°å€¼ã€FWHMã€ååº¦ï¼‰
   - âœ… æ›´æ–° `test_film_spectra.py`ï¼ˆæ–°å¢ Î”E é©—è­‰ï¼‰

---

## ğŸ” ç•¶å‰ç‹€æ³åˆ†æ

### ç•¶å‰å¯¦ä½œ (Phase 4.4 - å·²å®Œæˆ)

**æª”æ¡ˆ**ï¼š`scripts/generate_film_spectra.py` + `data/film_spectral_sensitivity.npz`

**æ–¹æ³•**ï¼šå¤šé«˜æ–¯æ··åˆ (Multi-Gaussian Mixture)

**å¯¦ä½œç¯„ä¾‹** (Portra 400 ç´…å±¤):
```python
# ä¸»å³° + 2 å€‹æ¬¡å³°
red_sens = multi_gaussian(WAVELENGTHS, [
    (650, 60, 1.0),   # ç´…å…‰ä¸»å³°
    (550, 80, 0.25),  # ç¶ å…‰äº¤å‰ï¼ˆå¯¬å®¹åº¦ï¼‰
    (450, 40, 0.05)   # è—å…‰å¾®å¼±ï¼ˆå›ºæœ‰æ•æ„Ÿï¼‰
])
```

**å·²å¯¦ç¾ç‰¹æ€§**ï¼š
- âœ… å¤šå³°çµæ§‹ï¼ˆ2-4 å€‹é«˜æ–¯å³°ç–ŠåŠ ï¼‰
- âœ… éå°ç¨±å½¢ç‹€ï¼ˆé€šéä¸åŒ sigma å¯¦ç¾ï¼‰
- âœ… å±¤é–“é‡ç–Šï¼ˆé€šéäº¤å‰æ•æ„Ÿåº¦é …ï¼‰
- âœ… 31 æ³¢é•·é»ï¼ˆ380-770nm, 13nm é–“éš”ï¼‰

**åˆ†æçµæœ** (å¯¦æ¸¬æ•¸æ“š):
```
Portra400:
  red  : peak=640nm, FWHM=143nm, shape=left-skew  âœ…
  green: peak=549nm, FWHM=143nm, shape=right-skew âœ…
  blue : peak=445nm, FWHM=91nm,  shape=right-skew âœ…

Velvia50:
  red  : peak=640nm, FWHM=91nm,  shape=left-skew  âœ… (çª„é »é£½å’Œ)
  green: peak=549nm, FWHM=117nm, shape=right-skew âœ…
  blue : peak=445nm, FWHM=78nm,  shape=right-skew âœ…

Cinestill800T:
  red  : peak=627nm, FWHM=169nm, shape=left-skew  âœ… (é¢çµ²ç‡ˆå„ªåŒ–)
  green: peak=549nm, FWHM=143nm, shape=right-skew âœ…
  blue : peak=445nm, FWHM=91nm,  shape=right-skew âœ…
```

---

## âš ï¸ å•é¡Œè¨ºæ–·

### Roadmap è²ç¨±çš„å•é¡Œï¼š

> **P0-2**: "å…‰è­œæ•æ„Ÿåº¦æ›²ç·šéåº¦ç°¡åŒ–"  
> - ç•¶å‰ä½¿ç”¨å–®å³°å°ç¨±é«˜æ–¯ âŒ  
> - ç¼ºå°‘å¤šå³°çµæ§‹ âŒ  
> - å±¤é–“é‡ç–Šä¸æº–ç¢º âŒ

### å¯¦éš›ç‹€æ³ï¼š

**âœ… P0-2 å•é¡Œå·²éƒ¨åˆ†ä¿®æ­£ï¼**

ç•¶å‰å¯¦ä½œ **å·²ç¶“å¯¦ç¾**ï¼š
1. âœ… å¤šå³°çµæ§‹ï¼ˆ2-4 å€‹é«˜æ–¯ç–ŠåŠ ï¼‰
2. âœ… éå°ç¨±å½¢ç‹€ï¼ˆå¯¦æ¸¬ç¢ºèªå·¦å/å³åï¼‰
3. âœ… å±¤é–“é‡ç–Šï¼ˆäº¤å‰æ•æ„Ÿåº¦é …ï¼‰

**â“ ä½† Roadmap å»ºè­°å¯é€²ä¸€æ­¥æ”¹é€²**ï¼š

| é …ç›® | ç•¶å‰æ–¹æ³• | Roadmap å»ºè­° | å„ªå…ˆç´š |
|------|---------|-------------|--------|
| **æ•¸æ“šä¾†æº** | æ‰‹å‹•è¨­è¨ˆåƒæ•¸ | å» å•† CSV æ•¸ä½åŒ– | ğŸŸ¡ P1 |
| **å³°å€¼å½¢ç‹€** | å°ç¨±é«˜æ–¯ | åæ–œé«˜æ–¯/å°æ•¸å¸¸æ…‹ | ğŸŸ¡ P1 |
| **é©—è­‰æ–¹æ³•** | å³°å€¼+FWHM æª¢æŸ¥ | ColorChecker Î”E æ¸¬è©¦ | ğŸ”´ P0 |

---

## ğŸ¯ ä¿®æ­£ç­–ç•¥

### é¸é … Aï¼šä¿æŒç•¶å‰å¯¦ä½œ + æ·»åŠ é©—è­‰ï¼ˆæ¨è–¦ï¼‰

**ç†ç”±**ï¼š
- ç•¶å‰å¤šé«˜æ–¯æ··åˆå·²æ»¿è¶³ç‰©ç†è¦æ±‚ï¼ˆå¤šå³°ã€éå°ç¨±ã€é‡ç–Šï¼‰
- å•é¡Œæ˜¯ã€Œç¼ºå°‘è‰²å½©æº–ç¢ºåº¦é©—è­‰ã€è€Œéã€Œæ¨¡å‹éæ–¼ç°¡åŒ–ã€

**å·¥ä½œé …**ï¼š
1. âœ… **ä¿æŒ** `generate_film_spectra.py` ç•¶å‰åƒæ•¸
2. ğŸ”§ **æ–°å¢** ColorChecker Î”E é©—è­‰æ¸¬è©¦
3. ğŸ”§ **æ–°å¢** å…‰è­œå½¢ç‹€æ¸¬è©¦ï¼ˆååº¦ã€å³°å€¼æ•¸é‡ã€FWHMï¼‰
4. ğŸ”§ **å¾®èª¿** åƒæ•¸ä»¥å„ªåŒ– Î”Eï¼ˆå¦‚éœ€è¦ï¼‰

**é ä¼°æ™‚é–“**: 2-3 å°æ™‚

---

### é¸é … Bï¼šå‡ç´šåˆ°åæ–œé«˜æ–¯æ¨¡å‹ï¼ˆRoadmap å»ºè­°ï¼‰

**ç†ç”±**ï¼š
- çœŸå¯¦è† ç‰‡æ›²ç·šå¯èƒ½å…·æ›´è¤‡é›œçš„ååº¦ï¼ˆéå°ç¨±é«˜æ–¯ç„¡æ³•å®Œç¾æ“¬åˆï¼‰
- å°æ•¸å¸¸æ…‹åˆ†å¸ƒæ›´ç¬¦åˆæŸ“æ–™å¸æ”¶ç‰¹æ€§

**å·¥ä½œé …**ï¼š
1. å¯¦ä½œåæ–œé«˜æ–¯å‡½æ•¸ï¼ˆ`skew_gaussian`ï¼‰
2. é‡æ–°æ“¬åˆ 4 ç¨®è† ç‰‡çš„åƒæ•¸
3. é‡æ–°ç”Ÿæˆ `film_spectral_sensitivity.npz`
4. å›æ­¸æ¸¬è©¦ + Î”E é©—è­‰

**é ä¼°æ™‚é–“**: 4-6 å°æ™‚

**é¢¨éšª**ï¼š
- åƒæ•¸æ“¬åˆè€—æ™‚ï¼ˆéœ€æ‰‹å‹•èª¿æ ¡æˆ–å„ªåŒ–ï¼‰
- å¯èƒ½ç„¡é¡¯è‘—è¦–è¦ºæ”¹é€²ï¼ˆé«˜æ–¯æ··åˆå·²è¶³å¤ å¥½ï¼‰

---

### é¸é … Cï¼šæ•´åˆå» å•†çœŸå¯¦æ•¸æ“šï¼ˆæœ€æº–ç¢ºï¼‰

**ç†ç”±**ï¼š
- Kodak/Fuji å®˜æ–¹æ•¸æ“šè¡¨æœ‰å…‰è­œæ›²ç·šåœ–
- æ•¸ä½åŒ–å¾Œå¯ç›´æ¥ä½¿ç”¨ï¼ˆå…æ“¬åˆï¼‰

**å·¥ä½œé …**ï¼š
1. ğŸ” æ”¶é›†å» å•†æ•¸æ“šè¡¨ï¼ˆPDF/åœ–ç‰‡ï¼‰
2. ğŸ”§ æ•¸ä½åŒ–å…‰è­œæ›²ç·šï¼ˆæ‰‹å‹•æˆ–å·¥å…·å¦‚ WebPlotDigitizerï¼‰
3. ğŸ”§ å‰µå»º CSV è¼‰å…¥åŠŸèƒ½
4. ğŸ”§ Fallback åˆ°å¤šé«˜æ–¯ï¼ˆç„¡ CSV æ™‚ï¼‰

**é ä¼°æ™‚é–“**: 6-10 å°æ™‚ï¼ˆåŒ…å«æ•¸ä½åŒ–ï¼‰

**æŒ‘æˆ°**ï¼š
- æ•¸æ“šè¡¨å¯èƒ½ä¸å…¬é–‹æˆ–è§£æåº¦ä½
- æ•¸ä½åŒ–èª¤å·®ï¼ˆéœ€å¤šæ¬¡æ ¡æº–ï¼‰
- ç¶­è­·æˆæœ¬ï¼ˆæ¯å¢åŠ æ–°è† ç‰‡éœ€é‡è¤‡æµç¨‹ï¼‰

---

## ğŸ“Š æ±ºç­–çŸ©é™£

| é¸é … | ç‰©ç†æ”¹é€²å¹…åº¦ | è‰²å½©æº–ç¢ºåº¦æå‡ | å¯¦ä½œæˆæœ¬ | ç¶­è­·æˆæœ¬ | æ¨è–¦åº¦ |
|------|------------|--------------|---------|---------|--------|
| **A: æ·»åŠ é©—è­‰** | 0% (å·²è¶³å¤ ) | +5-10% (é©—è­‰) | ä½ (2-3h) | ä½ | â­â­â­â­â­ |
| **B: åæ–œé«˜æ–¯** | +5-10% | +5-15% | ä¸­ (4-6h) | ä¸­ | â­â­â­ |
| **C: å» å•†æ•¸æ“š** | +10-20% | +10-30% | é«˜ (6-10h) | é«˜ | â­â­ |

---

## ğŸš€ åŸ·è¡Œè¨ˆç•«ï¼ˆé¸é … A - æ¨è–¦ï¼‰

### Phase 1: å…‰è­œå½¢ç‹€æ¸¬è©¦ (30 min)

**æ–°å»ºæª”æ¡ˆ**: `tests/test_spectral_sensitivity.py`

**æ¸¬è©¦é …ç›®**ï¼š
1. å¤šå³°æª¢æ¸¬ï¼ˆè‡³å°‘ 2 å€‹å±€éƒ¨æœ€å¤§å€¼ï¼‰
2. ååº¦æª¢æŸ¥ï¼ˆå·¦å/å³åç¬¦åˆé æœŸï¼‰
3. FWHM ç¯„åœé©—è­‰ï¼ˆçª„é » vs å¯¬é »ï¼‰
4. å³°å€¼ä½ç½®å®¹å¿ç¯„åœï¼ˆÂ±10nmï¼‰

**åƒè€ƒå¯¦ä½œ**ï¼š
```python
def test_multi_peak_structure():
    """æ¸¬è©¦å¤šå³°çµæ§‹"""
    data = np.load('data/film_spectral_sensitivity.npz')
    
    # Portra400 ç´…å±¤æ‡‰æœ‰ 2-3 å€‹å³°
    red_sens = data['Portra400_red']
    peaks = find_local_maxima(red_sens, threshold=0.2)
    assert len(peaks) >= 2, "ç´…å±¤æ‡‰è‡³å°‘æœ‰ 2 å€‹å³°"

def test_spectral_skewness():
    """æ¸¬è©¦ååº¦"""
    # ç´…å±¤æ‡‰å·¦åï¼ˆé•·å°¾åœ¨çŸ­æ³¢é•·å´ï¼‰
    red_sens = data['Portra400_red']
    skew = calculate_skewness(red_sens)
    assert skew < -0.1, "ç´…å±¤æ‡‰å·¦å"
```

---

### Phase 2: ColorChecker Î”E é©—è­‰ (1.5 hour)

**æ›´æ–°æª”æ¡ˆ**: `tests/test_film_spectra.py`

**æµç¨‹**ï¼š
1. è¼‰å…¥ ColorChecker 24 è‰²å¡ sRGB å€¼
2. RGB â†’ Spectrum (Smits 31 é€šé“)
3. æ–½åŠ è† ç‰‡å…‰è­œæ•æ„Ÿåº¦ï¼š`response = spectrum * sensitivity`
4. Spectrum â†’ XYZ â†’ sRGB (D65 å…‰æº)
5. è¨ˆç®— Î”E00 (CIEDE2000)

**é©—æ”¶é–¾å€¼**ï¼š
- å¹³å‡ Î”E00 < 5.0 âœ…
- æœ€å¤§ Î”E00 < 8.0 âœ…
- 95% è‰²å¡Š Î”E00 < 6.0 âœ…

**åƒè€ƒå¯¦ä½œ**ï¼š
```python
def test_colorchecker_round_trip():
    """ColorChecker å¾€è¿”æ¸¬è©¦"""
    from colour import delta_E_CIE2000
    
    # è¼‰å…¥ ColorChecker
    cc_rgb = load_colorchecker_24()  # (24, 3)
    
    # å¾€è¿”è½‰æ›
    for rgb_in in cc_rgb:
        # RGB â†’ Spectrum
        spectrum = smits_rgb_to_spectrum(rgb_in)
        
        # æ–½åŠ è† ç‰‡æ•æ„Ÿåº¦
        film_response = apply_film_sensitivity(spectrum, 'Portra400')
        
        # Spectrum â†’ RGB
        rgb_out = spectrum_to_rgb(film_response, illuminant='D65')
        
        # Î”E00
        delta_e = delta_E_CIE2000(rgb_in, rgb_out)
        assert delta_e < 8.0
    
    assert np.mean(delta_e_list) < 5.0
```

---

### Phase 3: åƒæ•¸å¾®èª¿ï¼ˆå¦‚éœ€è¦ï¼‰(1 hour)

**è§¸ç™¼æ¢ä»¶**ï¼šPhase 2 æ¸¬è©¦å¤±æ•—ï¼ˆÎ”E > é–¾å€¼ï¼‰

**å¾®èª¿æ–¹å‘**ï¼š
1. èª¿æ•´äº¤å‰æ•æ„Ÿåº¦ä¿‚æ•¸ï¼ˆå±¤é–“é‡ç–Šï¼‰
2. èª¿æ•´æ¬¡å³°ä½ç½®èˆ‡å¼·åº¦
3. èª¿æ•´ FWHMï¼ˆsigma åƒæ•¸ï¼‰

**å·¥å…·**ï¼š
```bash
python scripts/optimize_film_spectra.py \
  --target-film Portra400 \
  --metric delta_e \
  --max-iterations 100
```

---

### Phase 4: æ–‡æª”æ›´æ–° (30 min)

1. æ›´æ–° `COMPUTATIONAL_OPTICS_TECHNICAL_DOC.md`ï¼ˆå…‰è­œæ•æ„Ÿåº¦ç« ç¯€ï¼‰
2. æ›´æ–° `context/decisions_log.md`ï¼ˆè¨˜éŒ„ Decision #021ï¼‰
3. æ›´æ–° `tasks/PHYSICS_IMPROVEMENTS_ROADMAP.md`ï¼ˆæ¨™è¨˜ P0-2 å®Œæˆï¼‰

---

## ğŸ§ª æ¸¬è©¦ç­–ç•¥

### å–®å…ƒæ¸¬è©¦

- `test_spectral_sensitivity.py::test_multi_peak_structure` âœ…
- `test_spectral_sensitivity.py::test_spectral_skewness` âœ…
- `test_spectral_sensitivity.py::test_fwhm_ranges` âœ…
- `test_spectral_sensitivity.py::test_peak_positions` âœ…

### æ•´åˆæ¸¬è©¦

- `test_film_spectra.py::test_colorchecker_round_trip` âœ…
- `test_film_spectra.py::test_film_specific_color_shifts` âœ…ï¼ˆå¦‚ Velvia é£½å’Œç¶ ï¼‰

### è¦–è¦ºæ¸¬è©¦

- ColorChecker 24 è‰²å¡æ¸²æŸ“å°æ¯”
- å¯¦æ‹ç…§ç‰‡ A/B å°æ¯”ï¼ˆä¿®æ­£å‰ vs ä¿®æ­£å¾Œï¼‰

---

## ğŸ”’ é¢¨éšªèˆ‡é™åˆ¶

### å·²çŸ¥é™åˆ¶

1. **Smits æ–¹æ³•å›ºæœ‰èª¤å·®**ï¼š
   - RGB â†’ Spectrum å¾€è¿”èª¤å·® Î”E â‰ˆ 2-4ï¼ˆbaselineï¼‰
   - å…‰è­œæ•æ„Ÿåº¦åªèƒ½é€²ä¸€æ­¥å„ªåŒ–ï¼Œç„¡æ³•å®Œå…¨æ¶ˆé™¤ Smits èª¤å·®

2. **ç¼ºå°‘çœŸå¯¦æ¸¬è©¦æ•¸æ“š**ï¼š
   - ç„¡æ³•èˆ‡çœŸå¯¦è† ç‰‡æƒæå°æ¯”ï¼ˆç¼ºå°‘ GTï¼‰
   - åªèƒ½ä¾è³´ç†è«–æŒ‡æ¨™ï¼ˆÎ”Eã€FWHMï¼‰

3. **è† ç‰‡é–“å·®ç•°**ï¼š
   - åŒç‰‡ç¨®ä¸åŒæ‰¹æ¬¡å¯èƒ½æœ‰å·®ç•°
   - å„²å­˜æ¢ä»¶å½±éŸ¿æ•æ„Ÿåº¦æ›²ç·š

### é¢¨éšªç·©è§£

- Phase 2 å¤±æ•— â†’ åŸ·è¡Œ Phase 3 å¾®èª¿
- è¦–è¦ºæ¸¬è©¦ä¸æ»¿æ„ â†’ è€ƒæ…®é¸é … Bï¼ˆåæ–œé«˜æ–¯ï¼‰
- éœ€è¦æ¥µè‡´æº–ç¢ºåº¦ â†’ é•·æœŸè¦åŠƒé¸é … Cï¼ˆå» å•†æ•¸æ“šï¼‰

---

## âœ… å®Œæˆæ¨™æº–

1. **ä»£ç¢¼**ï¼š
   - âœ… `tests/test_spectral_sensitivity.py` å‰µå»ºä¸¦é€šé
   - âœ… `tests/test_film_spectra.py` æ›´æ–°ä¸¦é€šé
   - âœ… æ‰€æœ‰ç¾æœ‰æ¸¬è©¦ä¿æŒé€šéï¼ˆ83/87ï¼‰

2. **æ–‡æª”**ï¼š
   - âœ… `decisions_log.md` è¨˜éŒ„ Decision #021
   - âœ… `PHYSICS_IMPROVEMENTS_ROADMAP.md` æ¨™è¨˜ P0-2 å®Œæˆ

3. **æŒ‡æ¨™**ï¼š
   - âœ… ColorChecker å¹³å‡ Î”E00 < 5.0
   - âœ… ColorChecker æœ€å¤§ Î”E00 < 8.0
   - âœ… æ‰€æœ‰è† ç‰‡æ›²ç·šé€šéå½¢ç‹€æ¸¬è©¦

---

## ğŸ“š åƒè€ƒè³‡æ–™

1. **è‰²å½©ç§‘å­¸**ï¼š
   - CIEDE2000 å…¬å¼ï¼šISO/CIE 11664-6:2014
   - ColorChecker æ¨™æº–ï¼šX-Rite/Pantone

2. **è† ç‰‡æ•¸æ“š**ï¼š
   - Kodak Portra datasheets
   - Fuji Velvia technical data
   - "The Theory of the Photographic Process" (Mees & James, 1977)

3. **å¯¦ä½œåƒè€ƒ**ï¼š
   - `colour-science` library (Python)
   - Smits (1999) RGB-to-Spectrum conversion

---

**å‰µå»ºè€…**: Main Agent  
**æœ€å¾Œæ›´æ–°**: 2025-12-20 20:30
