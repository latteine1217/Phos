# Phos UI Refactoring - Manual Test Plan

## 測試環境
- Branch: `refactor/ui-separation`
- Python: 3.13
- Command: `streamlit run Phos.py`

## 自動化驗證結果 ✅
- [x] Python 語法檢查：通過
- [x] 模組導入檢查：通過（Streamlit 警告可忽略）
- [x] 單元測試：59/59 通過
- [x] 參數流動邏輯：驗證通過

## 手動 UI 測試清單

### 1. 應用啟動測試
- [ ] 執行 `streamlit run Phos.py`
- [ ] 應用無錯誤啟動
- [ ] 瀏覽器自動開啟 localhost:8501
- [ ] 歡迎頁面正確顯示

### 2. 側邊欄測試
- [ ] **處理模式切換**
  - [ ] "單張處理" 選項可選
  - [ ] "批量處理" 選項可選
  - [ ] 切換時文件上傳器正確更新

- [ ] **底片選擇**
  - [ ] 下拉選單顯示所有底片類型
  - [ ] 選擇 "Portra400" 成功
  - [ ] 選擇 "Ektar100" 成功
  - [ ] 選擇 "HP5Plus400" 成功
  - [ ] 選擇 "CineStill800T" 成功

- [ ] **顆粒風格**
  - [ ] "細膩" 選項可選
  - [ ] "標準" 選項可選
  - [ ] "粗獷" 選項可選

- [ ] **色調風格**
  - [ ] "平衡" 選項可選
  - [ ] "鮮豔" 選項可選
  - [ ] "自然" 選項可選
  - [ ] "柔和" 選項可選

- [ ] **渲染模式**
  - [ ] "Artistic（快速）" 選項可選
  - [ ] "Physics（精確）" 選項可選
  - [ ] Physics 模式下顯示進階參數

### 3. 單張處理測試
- [ ] **文件上傳**
  - [ ] 上傳 JPG 圖像成功
  - [ ] 上傳 PNG 圖像成功
  - [ ] 無效格式被拒絕

- [ ] **圖像處理**
  - [ ] 處理成功（無錯誤訊息）
  - [ ] 顯示處理時間
  - [ ] 顯示原圖（左側）
  - [ ] 顯示結果圖（右側）

- [ ] **結果展示**
  - [ ] 圖像色彩正確（無異常）
  - [ ] 下載按鈕顯示
  - [ ] 點擊下載按鈕成功下載 PNG

### 4. 批量處理測試
- [ ] **文件上傳**
  - [ ] 上傳 3 張圖像
  - [ ] 顯示 "已上傳 3 張照片"
  - [ ] 顯示預計處理時間

- [ ] **處理控制**
  - [ ] "開始處理" 按鈕顯示
  - [ ] 點擊後開始處理
  - [ ] 進度條正常更新（1/3, 2/3, 3/3）

- [ ] **結果展示**
  - [ ] 3 張圖像都顯示在結果區
  - [ ] 每張圖像都有下載按鈕
  - [ ] "批量下載" ZIP 按鈕顯示
  - [ ] 點擊 ZIP 下載成功

### 5. Physics 模式進階測試
- [ ] **Bloom 參數**
  - [ ] 閾值滑桿調整正常（0.5-0.95）
  - [ ] 散射比例調整正常（0.05-0.3）
  - [ ] 調整後重新處理，結果有明顯變化

- [ ] **H&D 曲線**
  - [ ] 啟用 H&D 曲線勾選框可切換
  - [ ] Gamma 滑桿調整正常（0.5-0.8）
  - [ ] Toe/Shoulder 強度調整正常

- [ ] **顆粒參數**
  - [ ] 尺寸滑桿調整正常（0.5-3.0）
  - [ ] 強度滑桿調整正常（0.3-1.5）

- [ ] **光譜響應**
  - [ ] 啟用/停用開關正常
  - [ ] 選擇不同底片光譜，結果有色調變化

- [ ] **互易律失效**
  - [ ] 啟用/停用開關正常
  - [ ] 曝光時間滑桿調整正常（0.1s-120s）
  - [ ] 顯示補償需求與亮度損失

### 6. 錯誤處理測試
- [ ] 無文件上傳時顯示歡迎頁面
- [ ] 上傳錯誤格式時顯示錯誤訊息
- [ ] 批量上傳超過 50 張時顯示錯誤

### 7. 回歸測試
- [ ] **與舊版本對比**（可選）
  - [ ] 切換到 main 分支執行 `streamlit run Phos.py`
  - [ ] 同一張圖像處理，對比結果是否一致
  - [ ] UI 外觀是否一致

## 測試資料準備
建議準備以下測試圖像：
- 1 張標準風景照（JPG, ~2MB）
- 1 張人像照（JPG, ~3MB）
- 1 張 PNG 透明背景圖
- 3 張小圖像用於批量測試（每張 <1MB）

## 預期問題與解決方案

### 可能的問題 1: 參數傳遞錯誤
**症狀**: 點擊處理後報錯 `KeyError` 或 `TypeError`
**解決**: 檢查 `render_sidebar()` 返回的字典鍵是否與 `Phos.py` 期望一致

### 可能的問題 2: Session State 衝突
**症狀**: 切換模式時狀態混亂
**解決**: 檢查 `st.session_state` 初始化邏輯

### 可能的問題 3: 顏色顯示異常
**症狀**: 圖像顏色偏藍/偏紅
**解決**: 檢查 BGR/RGB 轉換邏輯

## 測試報告範本

```
## 測試日期: YYYY-MM-DD
## 測試人員: [Your Name]
## 測試環境: macOS/Windows/Linux, Python 3.13

### 測試結果
- [ ] 所有測試通過
- [ ] 部分測試失敗（列出失敗項目）

### 發現的問題
1. [問題描述]
   - 重現步驟: [...]
   - 預期結果: [...]
   - 實際結果: [...]
   - 截圖: [如有]

### 建議
- [改進建議 1]
- [改進建議 2]
```

## 測試通過標準
1. ✅ 所有核心功能正常（單張處理、批量處理）
2. ✅ UI 無明顯錯誤或崩潰
3. ✅ 處理結果與舊版本一致
4. ✅ 下載功能正常
5. ✅ 參數調整有明顯效果

## 測試失敗處理流程
1. 記錄錯誤訊息與堆疊追蹤
2. 檢查是否為 UI 分離引入的問題
3. 如是新問題：在 `refactor/ui-separation` 分支修復
4. 如是舊問題：記錄到 Issues，另行處理
5. 修復後重新執行測試

---

**注意**: 這是重構後的第一次手動測試，請**仔細記錄所有異常**，即使是小問題也要記錄。
